"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[549],{86266:function(e,t,n){let i;n.d(t,{KU:function(){return nk},L9:function(){return ne},YH:function(){return t8},_F:function(){return es},iV:function(){return ng},jE:function(){return nv},l8:function(){return nb},q$:function(){return nr}});var r=n(28341),o=n(61485),a=n(5948),l=n(57437),s=n(74685),c=n(21652),d=n(93810),h=n(2265),p=n(66759),u=n(29959),f=n(31464),y=n(83238),g=n(51779),m=n(82863),k=n(52141),v=n(25181),b=n(87746),x=n(40211),_=n(48769),w=n(4548),E=n(55337),S=n(90231),N=n(13735),T=n(84432),A=n(15302),R=n(50212),M=n(12404),B=n(66279),C=n(31684),D=n(29283);function P(e){if(!e)throw Error("Parameter 'portabletextType' missing (required)");let t=e.of?.find(function e(t){return t.type?e(t.type):"block"===t.name?t:null});if(!t)throw Error("Block type is not defined in this schema (required)");let n=t.fields?.find(e=>"children"===e.name);if(!n)throw Error("Children field for block type found in schema (required)");let i=n.type.of;if(!i)throw Error("Valid types for block children not found in schema (required)");let r=i.find(e=>"span"===e.name);if(!r)throw Error("Span type not found in schema (required)");let o=i.filter(e=>"span"!==e.name)||[],a=e.of?.filter(e=>e.name!==t.name)||[];return{styles:function(e){let t=e.fields?.find(e=>"style"===e.name);if(!t)throw Error("A field with name 'style' is not defined in the block type (required).");let n=t.type.options?.list&&t.type.options.list?.filter(e=>e.value);if(!n||0===n.length)throw Error("The style fields need at least one style defined. I.e: {title: 'Normal', value: 'normal'}.");return n}(t),decorators:r.decorators,lists:function(e){let t=e.fields?.find(e=>"listItem"===e.name);if(!t)throw Error("A field with name 'listItem' is not defined in the block type (required).");let n=t.type.options?.list&&t.type.options.list.filter(e=>e.value);if(!n)throw Error("The list field need at least to be an empty array");return n}(t),block:t,span:r,portableText:e,inlineObjects:o,blockObjects:a,annotations:r.annotations}}let O="sanity-pte:";function j(e){let t=`${O}${e}`;return f&&f.enabled(t)?f(t):f(O)}function L(e,t,n){let i;let r=[e.path[0]];if(!t)return null;let o=t[r[0]];if(!o)return null;let a=[{_key:o._key}];if(o._type!==n.block.name)return a;let l=e.path.slice(0,2),s=Array.isArray(o.children)&&o.children[l[1]];return s&&(i=["children",{_key:s._key}]),i?[...a,...i]:a}function $(e,t){if(!t)return[];let[n,i]=Array.from(p.ML.nodes(t,{at:[],match:t=>(0,o.Fd)(e[0])&&t._key===e[0]._key}))[0]||[void 0,void 0];if(!n||!p.W_.isElement(n))return[];if(t.isVoid(n))return[i[0],0];let r=[e[2]],a=n.children.findIndex(e=>c([{_key:e._key}],r));if(a>=0&&n.children[a]){let e=n.children[a];return p.W_.isElement(e)&&t.isVoid(e)?i.concat(a).concat(0):i.concat(a)}return[i[0],0]}function Y(e,t,n){if(!t)return null;let i=null,r=null,o=t.anchor&&L(t.anchor,e,n);o&&t.anchor&&(i={path:o,offset:t.anchor.offset});let a=t.focus&&L(t.focus,e,n);a&&t.focus&&(r={path:a,offset:t.focus.offset});let l=!!(p.e6.isRange(t)&&p.e6.isBackward(t));return i&&r?{anchor:i,focus:r,backward:l}:null}function z(e,t){if(!e||!t)return null;let n={path:$(e.anchor.path,t),offset:e.anchor.offset},i={path:$(e.focus.path,t),offset:e.focus.offset};return 0===i.path.length||0===n.path.length?null:i?{anchor:n,focus:i}:null}function I(e,t){if(!e||!t)return null;let n=[],i=e.offset||0,r="object"==typeof e.path[0]&&"_key"in e.path[0]&&e.path[0]._key,o="object"==typeof e.path[2]&&"_key"in e.path[2]&&e.path[2]._key,a=t.find(e=>e._key===r);if(!a)return null;if(n.push({_key:a._key}),a&&"children"===e.path[1]){if(!a.children||Array.isArray(a.children)&&0===a.children.length)return null;let t=Array.isArray(a.children)&&a.children.find(e=>e._key===o);if(!t)return null;n.push("children"),n.push({_key:t._key}),i=t.text&&t.text.length>=e.offset?e.offset:t.text&&t.text.length||0}return{path:n,offset:i}}f(O);let G="void-child";function V(e,t){let n=t[e._key];return n&&c(e,n)?n:(t[e._key]=e,e)}function U(e,{schemaTypes:t},n={}){return e&&Array.isArray(e)?e.map(e=>{let{_type:i,_key:r,...o}=e,a=[{_key:G,_type:"span",text:"",marks:[]}];if(e&&e._type===t.block.name){let l=!1,s=typeof e.style>"u",c=typeof e.markDefs>"u",d=typeof e.children>"u",h=(e.children||[]).map(e=>{let{_type:t,_key:i,...r}=e;return"span"!==t?(l=!0,V({_type:t,_key:i,children:a,value:r,__inline:!0},n)):e});return!(!s&&!c&&!d&&!l&&p.W_.isElement(e))?(s&&(o.style=t.styles[0].value),V({_type:i,_key:r,...o,children:h},n)):e}return V({_type:i,_key:r,children:a,value:o},n)}):[]}function F(e,t,n={}){return e.map(e=>{let{_key:i,_type:r}=e;if(!i||!r)throw Error("Not a valid block");if(r===t&&"children"in e&&Array.isArray(e.children)&&i){let t=!1,o=e.children.map(e=>{let{_type:i}=e;if("value"in e&&"span"!==i){t=!0;let{value:i,_key:r,_type:o,__inline:a,children:l,...s}=e;return V({...s,...i,_key:r,_type:o},n)}return e});return t?V({...e,children:o,_key:i,_type:r},n):e}let o="value"in e&&e.value;return V({_key:i,_type:r,..."object"==typeof o?o:{}},n)})}function W(e,t){return void 0===e||e&&Array.isArray(e)&&0===e.length||e&&Array.isArray(e)&&1===e.length&&p.W_.isElement(e[0])&&e[0]._type===t.block.name&&"style"in e[0]&&e[0].style===t.styles[0].value&&!("listItem"in e[0])&&Array.isArray(e[0].children)&&1===e[0].children.length&&p.xv.isText(e[0].children[0])&&"span"===e[0].children[0]._type&&!e[0].children[0].marks?.join("")&&""===e[0].children[0].text}let K=new WeakMap,H=new WeakMap,q=new WeakMap,J=new WeakMap,Z=new WeakMap,X=new WeakMap,Q=new WeakMap,ee=new WeakMap,et=e=>{let t,n;let i=(0,y.c)(4);return i[0]===Symbol.for("react.memo_cache_sentinel")?(t={userSelect:"none"},i[0]=t):t=i[0],i[1]!==e.value._key||i[2]!==e.value._type?(n=(0,l.jsxs)("div",{style:t,children:["[",e.value._type,": ",e.value._key,"]"]}),i[1]=e.value._key,i[2]=e.value._type,i[3]=n):n=i[3],n};et.displayName="DefaultObject";let en=j("components:DraggableBlock"),ei=e=>{let t,n,i,r,o,a,s,c,d,f,g,m,k,v,b,x,_;let w=(0,y.c)(51),{children:E,element:S,readOnly:N,blockRef:T}=e,A=(0,u._7)(),R=(0,h.useRef)(void 0),[M,B]=(0,h.useState)(!1);w[0]!==A||w[1]!==S?(n=p.ML.isVoid(A,S),w[0]=A,w[1]=S,w[2]=n):n=w[2],t=n,w[3]!==A||w[4]!==S?(r=p.ML.isInline(A,S),w[3]=A,w[4]=S,w[5]=r):r=w[5],i=r;let[C,D]=(0,h.useState)(null);w[6]!==T||w[7]!==A||w[8]!==S?(o=()=>D(T?T.current:u.F3.toDOMNode(A,S)),a=[A,S,T],w[6]=T,w[7]=A,w[8]=S,w[9]=o,w[10]=a):(o=w[9],a=w[10]),(0,h.useEffect)(o,a),w[11]!==C||w[12]!==A||w[13]!==S?(s=e=>{let t=q.get(A);if(!t||!C)return;e.preventDefault(),e.dataTransfer.dropEffect="move",J.set(A,S);let n=C.getBoundingClientRect(),i=n.top,r=n.height,o=e.pageY;if(S===A.children[0]||(Math.abs(i-o)<r/2?Z.set(A,"top"):Z.set(A,"bottom")),t===S){e.dataTransfer.dropEffect="none";return}B(!0)},w[11]=C,w[12]=A,w[13]=S,w[14]=s):s=w[14];let P=s;w[15]===Symbol.for("react.memo_cache_sentinel")?(c=()=>{B(!1)},w[15]=c):c=w[15];let O=c;w[16]!==A||w[17]!==S?(d=e=>{let t=J.get(A);if(t){H.set(A,!1),e.preventDefault(),e.stopPropagation(),J.delete(A),R.current&&(en("Removing drag ghost"),document.body.removeChild(R.current));let n=Z.get(A);Z.delete(A);let i=u.F3.findPath(A,t),r=u.F3.findPath(A,S),o=p.y$.isBefore(r,i);if("bottom"===n&&!o){if(i[0]>=A.children.length-1){en("target is already at the bottom, not moving");return}let e=i;i=p.y$.next(i),en(`Adjusting targetPath from ${JSON.stringify(e)} to ${JSON.stringify(i)}`)}if("top"===n&&o&&i[0]!==A.children.length-1){let e=i;i=p.y$.previous(i),en(`Adjusting targetPath from ${JSON.stringify(e)} to ${JSON.stringify(i)}`)}if(p.y$.equals(i,r)){e.preventDefault(),en("targetPath and myPath is the same, not moving");return}en(`Moving element ${S._key} from path ${JSON.stringify(r)} to ${JSON.stringify(i)} (${n})`),p.YR.moveNodes(A,{at:r,to:i}),A.onChange();return}en("No target element, not doing anything")},w[16]=A,w[17]=S,w[18]=d):d=w[18];let j=d;w[19]!==A||w[20]!==S?(f=e=>{q.get(A)&&(en("On drop (prevented)",S),e.preventDefault(),e.stopPropagation(),B(!1))},w[19]=A,w[20]=S,w[21]=f):f=w[21];let L=f;w[22]!==A||w[23]!==S||w[24]!==t?(g=e=>{if(!t){q.delete(A);return}H.set(A,!0),q.set(A,S),e.stopPropagation();let n=e.target;n instanceof HTMLElement&&(n.style.opacity="1")},w[22]=A,w[23]=S,w[24]=t,w[25]=g):g=w[25];let $=g;w[26]!==C||w[27]!==A||w[28]!==$||w[29]!==i||w[30]!==t?(m=e=>{if(!t||i){en("Not dragging block"),q.delete(A),H.set(A,!1);return}if(en("Drag start"),H.set(A,!0),e.dataTransfer&&(e.dataTransfer.setData("application/portable-text","something"),e.dataTransfer.effectAllowed="move"),C&&C instanceof HTMLElement){let t=C.cloneNode(!0),n=t.querySelector("[data-pt-drag-ghost-element]");if(n&&(t=n),t.setAttribute("data-dragged",""),document.body){R.current=t,t.style.position="absolute",t.style.left="-99999px",t.style.boxSizing="border-box",document.body.appendChild(t);let n=C.getBoundingClientRect(),i=e.clientX-n.left,r=e.clientY-n.top;t.style.width=`${n.width}px`,t.style.height=`${n.height}px`,e.dataTransfer.setDragImage(t,i,r)}}$(e)},w[26]=C,w[27]=A,w[28]=$,w[29]=i,w[30]=t,w[31]=m):m=w[31];let Y=m;w[32]!==A||w[33]!==M?(k=M&&A.children[0]===J.get(A),w[32]=A,w[33]=M,w[34]=k):k=w[34];let z=k;w[35]!==A||w[36]!==M?(v=M&&A.children[A.children.length-1]===J.get(A),w[35]=A,w[36]=M,w[37]=v):v=w[37];let I=v,G=Z.get(A),V=z||M&&!z&&!I&&"top"===G,U=I||M&&!z&&!I&&"bottom"===G;if(w[38]===Symbol.for("react.memo_cache_sentinel")?(x=(0,l.jsx)("div",{className:"pt-drop-indicator",style:{position:"absolute",width:"100%",height:1,borderBottom:"1px solid currentColor",zIndex:5}}),w[38]=x):x=w[38],b=x,N){let e;return w[39]!==E?(e=(0,l.jsx)(l.Fragment,{children:E}),w[39]=E,w[40]=e):e=w[40],e}let F=V&&b,W=U&&b;return w[41]!==E||w[42]!==$||w[43]!==j||w[44]!==P||w[45]!==Y||w[46]!==L||w[47]!==t||w[48]!==F||w[49]!==W?(_=(0,l.jsxs)("div",{draggable:t,onDragStart:Y,onDrag:$,onDragOver:P,onDragLeave:O,onDragEnd:j,onDrop:L,children:[F,E,W]}),w[41]=E,w[42]=$,w[43]=j,w[44]=P,w[45]=Y,w[46]=L,w[47]=t,w[48]=F,w[49]=W,w[50]=_):_=w[50],_};ei.displayName="DraggableBlock",j("components:Element");let er=[],eo={display:"inline-block"},ea=({attributes:e,children:t,element:n,schemaTypes:i,readOnly:r,renderBlock:o,renderChild:a,renderListItem:s,renderStyle:c,spellCheck:d})=>{let f;let y=(0,u._7)(),g=(0,u.vt)(),m=(0,h.useRef)(null),k=(0,h.useRef)(null),v=g&&y.selection&&p.e6.isCollapsed(y.selection)||!1,b=(0,h.useMemo)(()=>F([n],i.block.name,Q.get(y))[0],[y,n,i.block.name]),x=t,_,w=(0,h.useMemo)(()=>[{_key:n._key}],[n]);if("string"!=typeof n._type)throw Error("Expected element to have a _type property");if("string"!=typeof n._key)throw Error("Expected element to have a _key property");if(y.isInline(n)){let o=u.F3.findPath(y,n),[s]=p.ML.node(y,o,{depth:1}),c=i.inlineObjects.find(e=>e.name===n._type);if(!c)throw Error("Could not find type for inline block element");if(p.W_.isElement(s)){let i=[{_key:s._key},"children",{_key:n._key}];return(0,l.jsxs)("span",{...e,children:[t,(0,l.jsxs)("span",{draggable:!r,className:"pt-inline-object","data-testid":"pt-inline-object",ref:k,style:eo,contentEditable:!1,children:[a&&a({annotations:er,children:(0,l.jsx)(et,{value:b}),editorElementRef:k,focused:v,path:i,schemaType:c,selected:g,type:c,value:b}),!a&&(0,l.jsx)(et,{value:b})]},n._key)]})}throw Error("Block not found!")}if(n._type===i.block.name){let a;_="pt-block pt-text-block";let h="listItem"in n,p="style"in n&&n.style||"normal";_=`pt-block pt-text-block pt-text-block-style-${p}`;let u=i.styles.find(e=>e.value===p);if(c&&u&&(x=c({block:n,children:t,focused:v,selected:g,value:p,path:w,schemaType:u,editorElementRef:m})),h&&("number"==typeof n.level&&(a=n.level),_+=` pt-list-item pt-list-item-${n.listItem} pt-list-item-level-${a||1}`),y.isListBlock(b)&&h&&n.listItem){let e=i.lists.find(e=>e.value===n.listItem);s&&e&&(x=s({block:b,children:x,focused:v,selected:g,value:n.listItem,path:w,schemaType:e,level:b.level||1,editorElementRef:m}))}let f=Object.defineProperty({children:x,editorElementRef:m,focused:v,level:a,listItem:h?n.listItem:void 0,path:w,selected:g,style:p,schemaType:i.block,value:b},"type",{enumerable:!1,get:()=>(console.warn("Property 'type' is deprecated, use 'schemaType' instead."),i.block)}),k=o?o(f):t;return(0,l.jsx)("div",{...e,className:_,spellCheck:d,children:(0,l.jsx)(ei,{element:n,readOnly:r,blockRef:m,children:(0,l.jsx)("div",{ref:m,children:k})})},n._key)}let E=i.blockObjects.find(e=>e.name===n._type);if(!E)throw Error(`Could not find schema type for block element of _type ${n._type}`);_="pt-block pt-object-block";let S=F([n],i.block.name,Q.get(y))[0];return o&&(f=o(Object.defineProperty({children:(0,l.jsx)(et,{value:b}),editorElementRef:m,focused:v,path:w,schemaType:E,selected:g,value:S},"type",{enumerable:!1,get:()=>(console.warn("Property 'type' is deprecated, use 'schemaType' instead."),E)}))),(0,l.jsxs)("div",{...e,className:_,children:[t,(0,l.jsx)(ei,{element:n,readOnly:r,blockRef:m,children:(0,l.jsx)("div",{ref:m,contentEditable:!1,children:f||(0,l.jsx)(et,{value:b})})})]},n._key)};ea.displayName="Element";let el=(0,h.createContext)(null),es=()=>{let e=(0,h.useContext)(el);if(!e)throw Error("The `usePortableTextEditor` hook must be used inside the <PortableTextEditor> component's context.");return e};function ec(e){let t,n,i;let r=(0,y.c)(6);r[0]!==e.annotation?(t=()=>alert(JSON.stringify(e.annotation)),r[0]=e.annotation,r[1]=t):t=r[1];let o=t;return r[2]===Symbol.for("react.memo_cache_sentinel")?(n={color:"blue"},r[2]=n):n=r[2],r[3]!==o||r[4]!==e.children?(i=(0,l.jsx)("span",{style:n,onClick:o,children:e.children}),r[3]=o,r[4]=e.children,r[5]=i):i=r[5],i}function ed(e){return r.V.compile({name:"blockTypeSchema",types:[e]}).get(e.name)}ec.displayName="DefaultAnnotation";let eh=(0,v.cY)({types:{context:{},events:{},input:{},emitted:{}},actions:{"emit has pending patches":(0,b.e)({type:"has pending patches"}),"emit mutation":(0,b.e)(({context:e})=>({type:"mutation",patches:e.pendingPatches,snapshot:F(e.slateEditor.children,e.schema.block.name,Q.get(e.slateEditor))})),"clear pending patches":(0,b.a)({pendingPatches:[]}),"defer patch":(0,b.a)({pendingPatches:({context:e,event:t})=>[...e.pendingPatches,t.patch]})},guards:{"slate is normalizing":({context:e})=>p.ML.isNormalizing(e.slateEditor)}}).createMachine({id:"mutation",context:({input:e})=>({pendingPatches:[],schema:e.schema,slateEditor:e.slateEditor}),initial:"idle",states:{idle:{on:{patch:{actions:["defer patch","emit has pending patches"],target:"has pending patches"}}},"has pending patches":{after:{1e3:[{guard:"slate is normalizing",target:"idle",actions:["emit mutation","clear pending patches"]},{reenter:!0}]},on:{patch:{actions:["defer patch"],reenter:!0}}}}});function ep(e,t,n){let i=null,r=!0,a=[t.span.name,...t.inlineObjects.map(e=>e.name)],l=[t.block.name,...t.blockObjects.map(e=>e.name)];return void 0===e?{valid:!0,resolution:null,value:e}:Array.isArray(e)&&0!==e.length?(e.some((e,s)=>{if(!S(e))return i={patches:[(0,w.zN)([s])],description:`Block must be an object, got ${String(e)}`,action:"Unset invalid item",item:e,i18n:{description:"inputs.portable-text.invalid-value.not-an-object.description",action:"inputs.portable-text.invalid-value.not-an-object.action",values:{index:s}}},!0;if(!e._key||"string"!=typeof e._key)return i={patches:[(0,w.t8)({...e,_key:n()},[s])],description:`Block at index ${s} is missing required _key.`,action:"Set the block with a random _key value",item:e,i18n:{description:"inputs.portable-text.invalid-value.missing-key.description",action:"inputs.portable-text.invalid-value.missing-key.action",values:{index:s}}},!0;if(!e._type||!l.includes(e._type)){if("block"===e._type){let n=t.block.name;return i={patches:[(0,w.t8)({...e,_type:n},[{_key:e._key}])],description:`Block with _key '${e._key}' has invalid type name '${e._type}'. According to the schema, the block type name is '${n}'`,action:`Use type '${n}'`,item:e,i18n:{description:"inputs.portable-text.invalid-value.incorrect-block-type.description",action:"inputs.portable-text.invalid-value.incorrect-block-type.action",values:{key:e._key,expectedTypeName:n}}},!0}return i=!e._type&&(0,o.DG)({...e,_type:t.block.name})?{patches:[(0,w.t8)({...e,_type:t.block.name},[{_key:e._key}])],description:`Block with _key '${e._key}' is missing a type name. According to the schema, the block type name is '${t.block.name}'`,action:`Use type '${t.block.name}'`,item:e,i18n:{description:"inputs.portable-text.invalid-value.missing-block-type.description",action:"inputs.portable-text.invalid-value.missing-block-type.action",values:{key:e._key,expectedTypeName:t.block.name}}}:e._type?{patches:[(0,w.zN)([{_key:e._key}])],description:`Block with _key '${e._key}' has invalid _type '${e._type}'`,action:"Remove the block",item:e,i18n:{description:"inputs.portable-text.invalid-value.disallowed-type.description",action:"inputs.portable-text.invalid-value.disallowed-type.action",values:{key:e._key,typeName:e._type}}}:{patches:[(0,w.zN)([{_key:e._key}])],description:`Block with _key '${e._key}' is missing an _type property`,action:"Remove the block",item:e,i18n:{description:"inputs.portable-text.invalid-value.missing-type.description",action:"inputs.portable-text.invalid-value.missing-type.action",values:{key:e._key}}},!0}if(e._type===t.block.name){if(e.children&&!Array.isArray(e.children))return i={patches:[(0,w.t8)({children:[]},[{_key:e._key}])],description:`Text block with _key '${e._key}' has a invalid required property 'children'.`,action:"Reset the children property",item:e,i18n:{description:"inputs.portable-text.invalid-value.missing-or-invalid-children.description",action:"inputs.portable-text.invalid-value.missing-or-invalid-children.action",values:{key:e._key}}},!0;if(void 0===e.children||Array.isArray(e.children)&&0===e.children.length){let r={_type:t.span.name,_key:n(),text:"",marks:[]};return i={autoResolve:!0,patches:[(0,w.Cb)([],[{_key:e._key},"children"]),(0,w.$T)([r],"after",[{_key:e._key},"children",0])],description:`Children for text block with _key '${e._key}' is empty.`,action:"Insert an empty text",item:e,i18n:{description:"inputs.portable-text.invalid-value.empty-children.description",action:"inputs.portable-text.invalid-value.empty-children.action",values:{key:e._key}}},!0}let o=g(E(e.children.filter(e=>e._type===t.span.name).map(e=>e.marks||[])));if(Array.isArray(e.markDefs)&&e.markDefs.length>0){let t=g(e.markDefs.map(e=>e._key).filter(e=>!o.includes(e)));if(t.length>0)return i={autoResolve:!0,patches:t.map(t=>(0,w.zN)([{_key:e._key},"markDefs",{_key:t}])),description:`Block contains orphaned data (unused mark definitions): ${t.join(", ")}.`,action:"Remove unused mark definition item",item:e,i18n:{description:"inputs.portable-text.invalid-value.orphaned-mark-defs.description",action:"inputs.portable-text.invalid-value.orphaned-mark-defs.action",values:{key:e._key,unusedMarkDefs:t.map(e=>e.toString())}}},!0}let l=o.filter(e=>!t.decorators.map(e=>e.value).includes(e)).filter(t=>void 0===e.markDefs||!e.markDefs.find(e=>e._key===t));if(l.length>0){let n=e.children.filter(e=>e._type===t.span.name&&Array.isArray(e.marks)&&e.marks.some(e=>l.includes(e)));if(n){let t=l.join(", ");return i={autoResolve:!0,patches:n.map(t=>(0,w.t8)((t.marks||[]).filter(e=>!l.includes(e)),[{_key:e._key},"children",{_key:t._key},"marks"])),description:`Block with _key '${e._key}' contains marks (${t}) not supported by the current content model.`,action:"Remove invalid marks",item:e,i18n:{description:"inputs.portable-text.invalid-value.orphaned-marks.description",action:"inputs.portable-text.invalid-value.orphaned-marks.action",values:{key:e._key,orphanedMarks:l.map(e=>e.toString())}}},!0}}e.children.some((r,o)=>{if(!S(r))return i={patches:[(0,w.zN)([{_key:e._key},"children",o])],description:`Child at index '${o}' in block with key '${e._key}' is not an object.`,action:"Remove the item",item:e,i18n:{description:"inputs.portable-text.invalid-value.non-object-child.description",action:"inputs.portable-text.invalid-value.non-object-child.action",values:{key:e._key,index:o}}},!0;if(!r._key||"string"!=typeof r._key){let t={...r,_key:n()};return i={autoResolve:!0,patches:[(0,w.t8)(t,[{_key:e._key},"children",o])],description:`Child at index ${o} is missing required _key in block with _key ${e._key}.`,action:"Set a new random _key on the object",item:e,i18n:{description:"inputs.portable-text.invalid-value.missing-child-key.description",action:"inputs.portable-text.invalid-value.missing-child-key.action",values:{key:e._key,index:o}}},!0}return r._type?a.includes(r._type)?r._type===t.span.name&&"string"!=typeof r.text&&(i={patches:[(0,w.t8)({...r,text:""},[{_key:e._key},"children",{_key:r._key}])],description:`Child with _key '${r._key}' in block with key '${e._key}' has missing or invalid text property!`,action:"Write an empty text property to the object",item:e,i18n:{description:"inputs.portable-text.invalid-value.invalid-span-text.description",action:"inputs.portable-text.invalid-value.invalid-span-text.action",values:{key:e._key,childKey:r._key}}},!0):(i={patches:[(0,w.zN)([{_key:e._key},"children",{_key:r._key}])],description:`Child with _key '${r._key}' in block with key '${e._key}' has invalid '_type' property (${r._type}).`,action:"Remove the object",item:e,i18n:{description:"inputs.portable-text.invalid-value.disallowed-child-type.description",action:"inputs.portable-text.invalid-value.disallowed-child-type.action",values:{key:e._key,childKey:r._key,childType:r._type}}},!0):(i={patches:[(0,w.zN)([{_key:e._key},"children",{_key:r._key}])],description:`Child with _key '${r._key}' in block with key '${e._key}' is missing '_type' property.`,action:"Remove the object",item:e,i18n:{description:"inputs.portable-text.invalid-value.missing-child-type.description",action:"inputs.portable-text.invalid-value.missing-child-type.action",values:{key:e._key,childKey:r._key}}},!0)})&&(r=!1)}return!1})&&(r=!1),{valid:r,resolution:i,value:e}):{valid:!1,resolution:{patches:[(0,w.zN)([])],description:"Editor value must be an array of Portable Text blocks, or undefined.",action:"Unset the value",item:e,i18n:{description:"inputs.portable-text.invalid-value.not-an-array.description",action:"inputs.portable-text.invalid-value.not-an-array.action"}},value:e}}function eu(e,t){let n=ef(e)||!1;K.set(e,!0),t(),K.set(e,n)}function ef(e){return K.get(e)}let ey=new WeakMap;function eg(e,t){let n=ey.get(e);ey.set(e,!1),t(),ey.set(e,n)}function em(e){let[t,n]=e;return[t,n]}function ek(e,t){let n=e,i=t,r=n.length,o=i.length;if(0===r||0===o)return 0;r>o?n=n.substring(r-o):r<o&&(i=i.substring(0,r));let a=Math.min(r,o);if(n===i)return a;let l=0,s=1;for(let e=0;-1!==e;){let t=n.substring(a-s);if(-1===(e=i.indexOf(t)))break;s+=e,(0===e||n.substring(a-s)===i.substring(0,s))&&(l=s,s++)}return l}function ev(e,t){if(!e||!t||e[0]!==t[0])return 0;let n=0,i=Math.min(e.length,t.length),r=i,o=0;for(;n<r;)e.substring(o,r)===t.substring(o,r)?o=n=r:i=r,r=Math.floor((i-n)/2+n);return r}function eb(e,t){if(!e||!t||e[e.length-1]!==t[t.length-1])return 0;let n=0,i=Math.min(e.length,t.length),r=i,o=0;for(;n<r;)e.substring(e.length-r,e.length-o)===t.substring(t.length-r,t.length-o)?o=n=r:i=r,r=Math.floor((i-n)/2+n);return r}function ex(e,t,n,i,r){let o=e.substring(0,n),a=t.substring(0,i),l=e.substring(n),s=t.substring(i),c=eM(o,a,{checkLines:!1,deadline:r}),d=eM(l,s,{checkLines:!1,deadline:r});return c.concat(d)}function e_(e,t,n){let i=e.slice(n,n+Math.floor(e.length/4)),r=-1,o="",a,l,s,c;for(;-1!==(r=t.indexOf(i,r+1));){let i=ev(e.slice(n),t.slice(r)),d=eb(e.slice(0,n),t.slice(0,r));o.length<d+i&&(o=t.slice(r-d,r)+t.slice(r,r+i),a=e.slice(0,n-d),l=e.slice(n+i),s=t.slice(0,r-d),c=t.slice(r+i))}return 2*o.length>=e.length?[a||"",l||"",s||"",c||"",o||""]:null}var ew=Object.defineProperty,eE=Object.getOwnPropertySymbols,eS=Object.prototype.hasOwnProperty,eN=Object.prototype.propertyIsEnumerable,eT=(e,t,n)=>t in e?ew(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,eA=(e,t)=>{for(var n in t||(t={}))eS.call(t,n)&&eT(e,n,t[n]);if(eE)for(var n of eE(t))eN.call(t,n)&&eT(e,n,t[n]);return e};function eR(e,t,n){var i,r;let o;if(null===e||null===t)throw Error("Null input. (diff)");let a=eM(e,t,eA({checkLines:!0,deadline:(r=(i=n||{}).timeout||1,o=1,"u">typeof r&&(o=r<=0?Number.MAX_VALUE:r),Date.now()+1e3*o)},i));return function(e){for(let t=0;t<e.length;t++){let[n,i]=e[t];if(0===i.length)continue;let r=i[0];(function(e){let t=e.charCodeAt(0);return t>=55296&&t<=56319})(i[i.length-1])&&0===n&&eD(e,t,1),function(e){let t=e.charCodeAt(0);return t>=56320&&t<=57343}(r)&&0===n&&eD(e,t,-1)}for(let t=0;t<e.length;t++)0===e[t][1].length&&e.splice(t,1)}(a),a}function eM(e,t,n){let i=e,r=t;if(i===r)return i?[[0,i]]:[];let o=ev(i,r),a=i.substring(0,o);o=eb(i=i.substring(o),r=r.substring(o));let l=i.substring(i.length-o),s=function(e,t,n){let i;if(!e)return[[1,t]];if(!t)return[[-1,e]];let r=e.length>t.length?e:t,o=e.length>t.length?t:e,a=r.indexOf(o);if(-1!==a)return i=[[1,r.substring(0,a)],[0,o],[1,r.substring(a+o.length)]],e.length>t.length&&(i[0][0]=-1,i[2][0]=-1),i;if(1===o.length)return[[-1,e],[1,t]];let l=function(e,t,n=1){let i,r,o,a,l;if(n<=0)return null;let s=e.length>t.length?e:t,c=e.length>t.length?t:e;if(s.length<4||2*c.length<s.length)return null;let d=e_(s,c,Math.ceil(s.length/4)),h=e_(s,c,Math.ceil(s.length/2));if(d&&h)i=d[4].length>h[4].length?d:h;else{if(!d&&!h)return null;h?d||(i=h):i=d}if(!i)throw Error("Unable to find a half match.");return e.length>t.length?(r=i[0],o=i[1],a=i[2],l=i[3]):(a=i[0],l=i[1],r=i[2],o=i[3]),[r,o,a,l,i[4]]}(e,t);if(l){let e=l[0],t=l[1],i=l[2],r=l[3],o=l[4],a=eM(e,i,n),s=eM(t,r,n);return a.concat([[0,o]],s)}return n.checkLines&&e.length>100&&t.length>100?function(e,t,n){let i=e,r=t,o=function(e,t){let n=[],i={};function r(e){let t="",r=0,a=-1,l=n.length;for(;a<e.length-1;){-1===(a=e.indexOf(`
`,r))&&(a=e.length-1);let s=e.slice(r,a+1);(i.hasOwnProperty?i.hasOwnProperty(s):void 0!==i[s])?t+=String.fromCharCode(i[s]):(l===o&&(s=e.slice(r),a=e.length),t+=String.fromCharCode(l),i[s]=l,n[l++]=s),r=a+1}return t}n[0]="";let o=4e4,a=r(e);return o=65535,{chars1:a,chars2:r(t),lineArray:n}}(i,r);i=o.chars1,r=o.chars2;let a=o.lineArray,l=eM(i,r,{checkLines:!1,deadline:n.deadline});(function(e,t){for(let n=0;n<e.length;n++){let i=e[n][1],r=[];for(let e=0;e<i.length;e++)r[e]=t[i.charCodeAt(e)];e[n][1]=r.join("")}})(l,a),(l=function(e){let t=e.map(e=>em(e)),n=!1,i=[],r=0,o=null,a=0,l=0,s=0,c=0,d=0;for(;a<t.length;)0===t[a][0]?(i[r++]=a,l=c,s=d,c=0,d=0,o=t[a][1]):(1===t[a][0]?c+=t[a][1].length:d+=t[a][1].length,o&&o.length<=Math.max(l,s)&&o.length<=Math.max(c,d)&&(t.splice(i[r-1],0,[-1,o]),t[i[r-1]+1][0]=1,r--,a=--r>0?i[r-1]:-1,l=0,s=0,c=0,d=0,o=null,n=!0)),a++;for(n&&(t=ez(t)),t=eY(t),a=1;a<t.length;){if(-1===t[a-1][0]&&1===t[a][0]){let e=t[a-1][1],n=t[a][1],i=ek(e,n),r=ek(n,e);i>=r?(i>=e.length/2||i>=n.length/2)&&(t.splice(a,0,[0,n.substring(0,i)]),t[a-1][1]=e.substring(0,e.length-i),t[a+1][1]=n.substring(i),a++):(r>=e.length/2||r>=n.length/2)&&(t.splice(a,0,[0,e.substring(0,r)]),t[a-1][0]=1,t[a-1][1]=n.substring(0,n.length-r),t[a+1][0]=-1,t[a+1][1]=e.substring(r),a++),a++}a++}return t}(l)).push([0,""]);let s=0,c=0,d=0,h="",p="";for(;s<l.length;){switch(l[s][0]){case 1:d++,p+=l[s][1];break;case -1:c++,h+=l[s][1];break;case 0:if(c>=1&&d>=1){l.splice(s-c-d,c+d),s=s-c-d;let e=eM(h,p,{checkLines:!1,deadline:n.deadline});for(let t=e.length-1;t>=0;t--)l.splice(s,0,e[t]);s+=e.length}d=0,c=0,h="",p="";break;default:throw Error("Unknown diff operation.")}s++}return l.pop(),l}(e,t,n):function(e,t,n){let i=e.length,r=t.length,o=Math.ceil((i+r)/2),a=2*o,l=Array(a),s=Array(a);for(let e=0;e<a;e++)l[e]=-1,s[e]=-1;l[o+1]=0,s[o+1]=0;let c=i-r,d=c%2!=0,h=0,p=0,u=0,f=0;for(let y=0;y<o&&!(Date.now()>n);y++){for(let u=-y+h;u<=y-p;u+=2){let f;let g=o+u,m=(f=u===-y||u!==y&&l[g-1]<l[g+1]?l[g+1]:l[g-1]+1)-u;for(;f<i&&m<r&&e.charAt(f)===t.charAt(m);)f++,m++;if(l[g]=f,f>i)p+=2;else if(m>r)h+=2;else if(d){let r=o+c-u;if(r>=0&&r<a&&-1!==s[r]&&f>=i-s[r])return ex(e,t,f,m,n)}}for(let h=-y+u;h<=y-f;h+=2){let p;let g=o+h,m=(p=h===-y||h!==y&&s[g-1]<s[g+1]?s[g+1]:s[g-1]+1)-h;for(;p<i&&m<r&&e.charAt(i-p-1)===t.charAt(r-m-1);)p++,m++;if(s[g]=p,p>i)f+=2;else if(m>r)u+=2;else if(!d){let r=o+c-h;if(r>=0&&r<a&&-1!==l[r]){let a=l[r],s=o+a-r;if(a>=(p=i-p))return ex(e,t,a,s,n)}}}}return[[-1,e],[1,t]]}(e,t,n.deadline)}(i=i.substring(0,i.length-o),r=r.substring(0,r.length-o),n);return a&&s.unshift([0,a]),l&&s.push([0,l]),s=ez(s)}function eB(e,t,n){return 1===n?e+t:t+e}function eC(e,t){return 1===t?[e.substring(0,e.length-1),e[e.length-1]]:[e.substring(1),e[0]]}function eD(e,t,n){var i,r;let o=1===n?-1:1,a=null,l=null,s=t+n;for(;s>=0&&s<e.length&&(null===a||null===l);s+=n){let[i,r]=e[s];if(0!==r.length){if(1===i){null===a&&(a=s);continue}if(-1===i){null===l&&(l=s);continue}if(0===i){if(null===a&&null===l){let[i,r]=eC(e[t][1],n);e[t][1]=i,e[s][1]=eB(e[s][1],r,o);return}break}}}if(null!==a&&null!==l&&(i=a,r=l,1===n?e[i][1][e[i][1].length-1]===e[r][1][e[r][1].length-1]:e[i][1][0]===e[r][1][0])){let[i,r]=eC(e[a][1],o),[s]=eC(e[l][1],o);e[a][1]=i,e[l][1]=s,e[t][1]=eB(e[t][1],r,n);return}let[c,d]=eC(e[t][1],n);e[t][1]=c,null===a?(e.splice(s,0,[1,d]),null!==l&&l>=s&&l++):e[a][1]=eB(e[a][1],d,o),null===l?e.splice(s,0,[-1,d]):e[l][1]=eB(e[l][1],d,o)}let eP=/[^a-zA-Z0-9]/,eO=/\s/,ej=/[\r\n]/,eL=/\n\r?\n$/,e$=/^\r?\n\r?\n/;function eY(e){let t=e.map(e=>em(e));function n(e,t){if(!e||!t)return 6;let n=e.charAt(e.length-1),i=t.charAt(0),r=n.match(eP),o=i.match(eP),a=r&&n.match(eO),l=o&&i.match(eO),s=a&&n.match(ej),c=l&&i.match(ej),d=s&&e.match(eL),h=c&&t.match(e$);return d||h?5:s||c?4:r&&!a&&l?3:a||l?2:r||o?1:0}let i=1;for(;i<t.length-1;){if(0===t[i-1][0]&&0===t[i+1][0]){let e=t[i-1][1],r=t[i][1],o=t[i+1][1],a=eb(e,r);if(a){let t=r.substring(r.length-a);e=e.substring(0,e.length-a),r=t+r.substring(0,r.length-a),o=t+o}let l=e,s=r,c=o,d=n(e,r)+n(r,o);for(;r.charAt(0)===o.charAt(0);){e+=r.charAt(0),r=r.substring(1)+o.charAt(0),o=o.substring(1);let t=n(e,r)+n(r,o);t>=d&&(d=t,l=e,s=r,c=o)}t[i-1][1]!==l&&(l?t[i-1][1]=l:(t.splice(i-1,1),i--),t[i][1]=s,c?t[i+1][1]=c:(t.splice(i+1,1),i--))}i++}return t}function ez(e){let t=e.map(e=>em(e));t.push([0,""]);let n=0,i=0,r=0,o="",a="",l;for(;n<t.length;)switch(t[n][0]){case 1:r++,a+=t[n][1],n++;break;case -1:i++,o+=t[n][1],n++;break;case 0:i+r>1?(0!==i&&0!==r&&(0!==(l=ev(a,o))&&(n-i-r>0&&0===t[n-i-r-1][0]?t[n-i-r-1][1]+=a.substring(0,l):(t.splice(0,0,[0,a.substring(0,l)]),n++),a=a.substring(l),o=o.substring(l)),0!==(l=eb(a,o))&&(t[n][1]=a.substring(a.length-l)+t[n][1],a=a.substring(0,a.length-l),o=o.substring(0,o.length-l))),n-=i+r,t.splice(n,i+r),o.length&&(t.splice(n,0,[-1,o]),n++),a.length&&(t.splice(n,0,[1,a]),n++),n++):0!==n&&0===t[n-1][0]?(t[n-1][1]+=t[n][1],t.splice(n,1)):n++,r=0,i=0,o="",a="";break;default:throw Error("Unknown diff operation")}""===t[t.length-1][1]&&t.pop();let s=!1;for(n=1;n<t.length-1;)0===t[n-1][0]&&0===t[n+1][0]&&(t[n][1].substring(t[n][1].length-t[n-1][1].length)===t[n-1][1]?(t[n][1]=t[n-1][1]+t[n][1].substring(0,t[n][1].length-t[n-1][1].length),t[n+1][1]=t[n-1][1]+t[n+1][1],t.splice(n-1,1),s=!0):t[n][1].substring(0,t[n+1][1].length)===t[n+1][1]&&(t[n-1][1]+=t[n+1][1],t[n][1]=t[n][1].substring(t[n+1][1].length)+t[n+1][1],t.splice(n+1,1),s=!0)),n++;return s&&(t=ez(t)),t}var eI=Object.defineProperty,eG=Object.getOwnPropertySymbols,eV=Object.prototype.hasOwnProperty,eU=Object.prototype.propertyIsEnumerable,eF=(e,t,n)=>t in e?eI(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,eW=(e,t)=>{for(var n in t||(t={}))eV.call(t,n)&&eF(e,n,t[n]);if(eG)for(var n of eG(t))eU.call(t,n)&&eF(e,n,t[n]);return e};let eK={threshold:.5,distance:1e3};function eH(e,t,n){if(null===e||null===t||null===n)throw Error("Null input. (match())");let i=Math.max(0,Math.min(n,e.length));return e===t?0:e.length?e.substring(i,i+t.length)===t?i:function(e,t,n,i={}){if(t.length>32)throw Error("Pattern too long for this browser.");let r=eW(eW({},eK),i),o=function(e){let t={};for(let n=0;n<e.length;n++)t[e.charAt(n)]=0;for(let n=0;n<e.length;n++)t[e.charAt(n)]|=1<<e.length-n-1;return t}(t);function a(e,i){let o=e/t.length,a=Math.abs(n-i);return r.distance?o+a/r.distance:a?1:o}let l=r.threshold,s=e.indexOf(t,n);-1!==s&&(l=Math.min(a(0,s),l),-1!==(s=e.lastIndexOf(t,n+t.length))&&(l=Math.min(a(0,s),l)));let c=1<<t.length-1;s=-1;let d,h,p=t.length+e.length,u=[];for(let i=0;i<t.length;i++){for(d=0,h=p;d<h;)a(i,n+h)<=l?d=h:p=h,h=Math.floor((p-d)/2+d);p=h;let r=Math.max(1,n-h+1),f=Math.min(n+h,e.length)+t.length,y=Array(f+2);y[f+1]=(1<<i)-1;for(let t=f;t>=r;t--){let d=o[e.charAt(t-1)];if(0===i?y[t]=(y[t+1]<<1|1)&d:y[t]=(y[t+1]<<1|1)&d|((u[t+1]|u[t])<<1|1)|u[t+1],y[t]&c){let e=a(i,t-1);if(e<=l){if(l=e,(s=t-1)>n)r=Math.max(1,2*n-s);else break}}}if(a(i+1,n)>l)break;u=y}return s}(e,t,i):-1}function eq(e){let t=[];for(let n=0;n<e.length;n++)1!==e[n][0]&&(t[n]=e[n][1]);return t.join("")}function eJ(e){let t=[];for(let n=0;n<e.length;n++)-1!==e[n][0]&&(t[n]=e[n][1]);return t.join("")}function eZ(e,t){let n=0,i=0,r=0,o=0,a;for(a=0;a<e.length&&(1!==e[a][0]&&(n+=e[a][1].length),-1!==e[a][0]&&(i+=e[a][1].length),!(n>t));a++)r=n,o=i;return e.length!==a&&-1===e[a][0]?o:o+(t-r)}function eX(e){let t=0;for(let n=0;n<e.length;n++){let i=e.codePointAt(n);if(typeof i>"u")throw Error("Failed to get codepoint");t+=eQ(i)}return t}function eQ(e){return e<=127?1:e<=2047?2:e<=65535?3:4}function e0(e,t){return{diffs:[],start1:e,start2:t,utf8Start1:e,utf8Start2:t,length1:0,length2:0,utf8Length1:0,utf8Length2:0}}let e1=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;function e2(e){if(!e)return[];let t=[],n=e.split(`
`),i=0;for(;i<n.length;){let e=n[i].match(e1);if(!e)throw Error(`Invalid patch string: ${n[i]}`);let r=e0(e3(e[1]),e3(e[3]));for(t.push(r),""===e[2]?(r.start1--,r.utf8Start1--,r.length1=1,r.utf8Length1=1):"0"===e[2]?(r.length1=0,r.utf8Length1=0):(r.start1--,r.utf8Start1--,r.utf8Length1=e3(e[2]),r.length1=r.utf8Length1),""===e[4]?(r.start2--,r.utf8Start2--,r.length2=1,r.utf8Length2=1):"0"===e[4]?(r.length2=0,r.utf8Length2=0):(r.start2--,r.utf8Start2--,r.utf8Length2=e3(e[4]),r.length2=r.utf8Length2),i++;i<n.length;){let e;let t=n[i],o=t.charAt(0);if("@"===o)break;if(""===o){i++;continue}try{e=decodeURI(t.slice(1))}catch{throw Error(`Illegal escape in parse: ${t}`)}let a=eX(e)-e.length;if("-"===o)r.diffs.push([-1,e]),r.length1-=a;else if("+"===o)r.diffs.push([1,e]),r.length2-=a;else if(" "===o)r.diffs.push([0,e]),r.length1-=a,r.length2-=a;else throw Error(`Invalid patch mode "${o}" in: ${e}`);i++}}return t}function e3(e){return parseInt(e,10)}let e8=new WeakMap,e4=new WeakMap;function e6(e){return e8.get(e)??!1}function e5(e){return e4.get(e)??!1}let e9=j("plugin:withUndoRedo"),e7=new WeakMap,te=new WeakMap,tt=e=>{let t=e7.get(e);return void 0===t||t},tn=e=>(te.get(e)||te.set(e,[]),te.get(e)||[]);function ti(e,t,n,i,r){let o={...n};if("insert"===t.type&&1===t.path.length){let e=(i||[]).findIndex(e=>c({_key:e._key},t.path[0]));return e9(`Adjusting block path (+${t.items.length}) for '${o.type}' operation and patch '${t.type}'`),[tr(o,t.items.length,e)]}if("unset"===t.type&&1===t.path.length){let e=(r||[]).findIndex(e=>c({_key:e._key},t.path[0]));return"path"in o&&Array.isArray(o.path)&&o.path[0]===e?(e9("Skipping transformation that targeted removed block"),[]):[tr(o,-1,e)]}if("unset"===t.type&&0===t.path.length)return e9(`Adjusting selection for unset everything patch and ${n.type} operation`),[];if("diffMatchPatch"===t.type){let n;let i=("set_selection"===o.type&&e.selection?n=e.children[e.selection.focus.path[0]]:"path"in o&&(n=e.children[o.path[0]]),n);return i&&c({_key:i._key},t.path[0])&&e2(t.value).forEach(e=>{let t=0,n=e.utf8Start1,{diffs:i}=e;if(i.forEach((e,r)=>{let[o,a]=e;1===o?(t+=a.length,n+=a.length):-1===o?(t-=a.length,n-=a.length):0===o&&(i.slice(r).every(([e])=>0===e)||(n+=a.length))}),"insert_text"===o.type&&n<o.offset&&(o.offset+=t),"remove_text"===o.type&&n<=o.offset-o.text.length&&(o.offset+=t),"set_selection"===o.type){let e=o.properties?.focus?{...o.properties.focus}:void 0,i=o?.properties?.anchor?{...o.properties.anchor}:void 0,r=o?.newProperties?.focus?{...o.newProperties.focus}:void 0,a=o?.newProperties?.anchor?{...o.newProperties.anchor}:void 0;(e&&i||r&&a)&&([e,i,r,a].forEach(e=>{e&&n<e.offset&&(e.offset+=t)}),e&&i&&(o.properties={focus:e,anchor:i}),r&&a&&(o.newProperties={focus:r,anchor:a}))}}),[o]}return[o]}function tr(e,t,n){let i={...e};if(n>=0&&"set_selection"!==i.type&&Array.isArray(i.path)&&i.path[0]>=n+t&&i.path[0]+t>-1){let e=[i.path[0]+t,...i.path.slice(1)];i.path=e}if("set_selection"===i.type){let e=i.properties?.focus?{...i.properties.focus}:void 0,r=i?.properties?.anchor?{...i.properties.anchor}:void 0,o=i?.newProperties?.focus?{...i.newProperties.focus}:void 0,a=i?.newProperties?.anchor?{...i.newProperties.anchor}:void 0;(e&&r||o&&a)&&([e,r,o,a].forEach(e=>{e&&e.path[0]>=n+t&&e.path[0]+t>-1&&(e.path=[e.path[0]+t,...e.path.slice(1)])}),e&&r&&(i.properties={focus:e,anchor:r}),o&&a&&(i.newProperties={focus:o,anchor:a}))}return i}let to=(e,t)=>!!("set_selection"===e.type||t&&"insert_text"===e.type&&"insert_text"===t.type&&e.offset===t.offset+t.text.length&&p.y$.equals(e.path,t.path)&&" "!==e.text||t&&"remove_text"===e.type&&"remove_text"===t.type&&e.offset+e.text.length===t.offset&&p.y$.equals(e.path,t.path)),ta=(e,t)=>!!(t&&"set_selection"===e.type&&"set_selection"===t.type),tl=e=>"set_selection"!==e.type;function ts(e,t){let n=tt(e);e7.set(e,!1),t(),e7.set(e,n)}let tc=(0,x.E9)(({sendBack:e,input:t})=>{tp({context:t.context,sendBack:e,slateEditor:t.slateEditor,value:t.value,streamBlocks:t.streamBlocks})}),td=(0,v.cY)({types:{context:{},input:{},events:{},emitted:{}},actions:{"assign initial value synced":(0,b.a)({initialValueSynced:!0}),"assign readOnly":(0,b.a)({readOnly:({event:e})=>((0,v.ZD)(e,"update readOnly"),e.readOnly)}),"assign pending value":(0,b.a)({pendingValue:({event:e})=>((0,v.ZD)(e,"update value"),e.value)}),"clear pending value":(0,b.a)({pendingValue:void 0}),"assign previous value":(0,b.a)({previousValue:({event:e})=>((0,v.ZD)(e,"done syncing"),e.value)}),"emit done syncing initial value":(0,b.e)({type:"done syncing initial value"})},guards:{"initial value synced":({context:e})=>e.initialValueSynced,"is busy":({context:e})=>!e.readOnly&&(e.isProcessingLocalChanges||(ef(e.slateEditor)??!1)),"value changed while syncing":({context:e,event:t})=>((0,v.ZD)(t,"done syncing"),e.pendingValue!==t.value),"pending value equals previous value":({context:e})=>!(void 0===e.previousValue&&void 0===e.pendingValue)&&c(e.pendingValue,e.previousValue)},actors:{"sync value":tc}}).createMachine({id:"sync",context:({input:e})=>({initialValueSynced:!1,isProcessingLocalChanges:!1,keyGenerator:e.keyGenerator,schema:e.schema,readOnly:e.readOnly,slateEditor:e.slateEditor,pendingValue:void 0,previousValue:void 0}),on:{"has pending patches":{actions:(0,b.a)({isProcessingLocalChanges:!0})},mutation:{actions:(0,b.a)({isProcessingLocalChanges:!1})},"update readOnly":{actions:["assign readOnly"]}},type:"parallel",states:{"setting up":{initial:"syncing initial value",states:{"syncing initial value":{always:{guard:"initial value synced",target:"done syncing initial value"}},"done syncing initial value":{entry:["emit done syncing initial value"],type:"final"}}},syncing:{initial:"idle",states:{idle:{on:{"update value":[{guard:"is busy",target:"busy",actions:["assign pending value"]},{target:"syncing",actions:["assign pending value"]}]}},busy:{after:{1e3:[{guard:"is busy",reenter:!0},{target:"syncing"}]},on:{"update value":[{actions:["assign pending value"]}]}},syncing:{always:{guard:"pending value equals previous value",target:"idle",actions:["clear pending value","assign initial value synced"]},invoke:{src:"sync value",id:"sync value",input:({context:e})=>({context:{keyGenerator:e.keyGenerator,previousValue:e.previousValue,readOnly:e.readOnly,schema:e.schema},slateEditor:e.slateEditor,streamBlocks:!e.initialValueSynced,value:e.pendingValue})},on:{"update value":{actions:["assign pending value"]},patch:{actions:[(0,b.e)(({event:e})=>e)]},"invalid value":{actions:[(0,b.e)(({event:e})=>e)]},"value changed":{actions:[(0,b.e)(({event:e})=>e)]},"done syncing":[{guard:"value changed while syncing",actions:["assign previous value","assign initial value synced"],reenter:!0},{target:"idle",actions:["clear pending value","assign previous value","assign initial value synced"]}]}}}}}}),th=j("hook:useSyncValue");async function tp({context:e,sendBack:t,slateEditor:n,streamBlocks:i,value:r}){let o=!1,a=!0,l=!!n.selection;if(r&&0!==r.length||(th("Value is empty"),p.ML.withoutNormalizing(n,()=>{ts(n,()=>{eg(n,()=>{l&&p.YR.deselect(n);let e=n.children.length;n.children.forEach((t,i)=>{p.YR.removeNodes(n,{at:[e-1-i]})}),p.YR.insertNodes(n,n.pteCreateTextBlock({decorators:[]}),{at:[0]}),l&&p.YR.select(n,[0,0])})})}),o=!0),r&&r.length>0){let l=U(r,{schemaTypes:e.schema});await new Promise(s=>{p.ML.withoutNormalizing(n,()=>{eu(n,()=>{eg(n,async()=>{let d=n.children.length;if(l.length<d){for(let e=d-1;e>l.length-1;e--)p.YR.removeNodes(n,{at:[e]});o=!0}for await(let[s,d]of tu({slateValue:l,streamBlocks:i})){let{blockChanged:i,blockValid:l}=function({context:e,sendBack:t,block:n,index:i,slateEditor:r,value:o}){let a=!1,l=!0,s=r.children[i],d=s&&!c(n,s);return p.ML.withoutNormalizing(r,()=>{eu(r,()=>{eg(r,()=>{if(d&&l){let d=[o[i]],h=ep(d,e.schema,e.keyGenerator);!h.valid&&h.resolution?.autoResolve&&h.resolution?.patches.length>0&&!e.readOnly&&e.previousValue&&e.previousValue!==o&&(console.warn(`${h.resolution.action} for block with _key '${d[0]._key}'. ${h.resolution?.description}`),h.resolution.patches.forEach(e=>{t({type:"patch",patch:e})})),h.valid||h.resolution?.autoResolve?(s._key===n._key?(th.enabled&&th("Updating block",s,n),function(e,t,n,i){if(p.YR.setNodes(e,t,{at:[i]}),e.isTextBlock(t)&&e.isTextBlock(n)){let r=n.children.length;t.children.length<r&&Array.from(Array(r-t.children.length)).forEach((t,n)=>{let o=r-1-n;o>0&&(th("Removing child"),p.YR.removeNodes(e,{at:[i,o]}))}),t.children.forEach((t,r)=>{let o=n.children[r],a=!c(t,o),l=!c(t.text,o?.text),s=[i,r];if(a){if(t._key===o?._key){th("Updating changed child",t,o),p.YR.setNodes(e,t,{at:s});let n=p.xv.isText(t)&&"span"===t._type&&p.xv.isText(o)&&"span"===o._type;n&&l?(p.YR.delete(e,{at:{focus:{path:s,offset:0},anchor:{path:s,offset:o.text.length}}}),p.YR.insertText(e,t.text,{at:s}),e.onChange()):n||(th("Updating changed inline object child",t),p.YR.setNodes(e,{_key:G},{at:[...s,0],voids:!0}))}else o?(th("Replacing child",t),p.YR.removeNodes(e,{at:[i,r]}),p.YR.insertNodes(e,t,{at:[i,r]}),e.onChange()):o||(th("Inserting new child",t),p.YR.insertNodes(e,t,{at:[i,r]}),e.onChange())}})}}(r,n,s,i)):(th.enabled&&th("Replacing block",s,n),function(e,t,n){let i=e.selection,r=i&&i.focus.path[0]===n;r&&p.YR.deselect(e),p.YR.removeNodes(e,{at:[n]}),p.YR.insertNodes(e,t,{at:[n]}),e.onChange(),r&&p.YR.select(e,i)}(r,n,i)),a=!0):(t({type:"invalid value",resolution:h.resolution,value:o}),l=!1)}if(!s&&l){let a=ep([o[i]],e.schema,e.keyGenerator);th.enabled&&th("Validating and inserting new block in the end of the value",n),a.valid||a.resolution?.autoResolve?p.YR.insertNodes(r,n,{at:[i]}):(th("Invalid",a),t({type:"invalid value",resolution:a.resolution,value:o}),l=!1)}})})}),{blockChanged:a,blockValid:l}}({context:e,sendBack:t,block:s,index:d,slateEditor:n,value:r});o=i||o,a=a&&l}s()})})})})}if(!a){th("Invalid value, returning"),t({type:"done syncing",value:r});return}if(o){th("Server value changed, syncing editor");try{n.onChange()}catch(e){console.error(e),t({type:"invalid value",resolution:null,value:r}),t({type:"done syncing",value:r});return}l&&!n.selection&&(p.YR.select(n,{anchor:{path:[0,0],offset:0},focus:{path:[0,0],offset:0}}),n.onChange()),t({type:"value changed",value:r})}else th("Server value and editor value is equal, no need to sync.");t({type:"done syncing",value:r})}async function*tu({slateValue:e,streamBlocks:t}){let n=0;for await(let i of e)t&&await new Promise(e=>setTimeout(e,0)),yield[i,n],n++}let tf=j("component:PortableTextEditor:Synchronizer");function ty(e){let t,n,i,r,o,a,l,c,d,p,u,f,g,m,k,v;let b=(0,y.c)(40),{editorActor:x,slateEditor:_}=e,w=(0,s.v9)(e.editorActor,tm),E=(0,s.v9)(e.editorActor,tg);b[0]!==e.editorActor?(t=e.editorActor.getSnapshot(),b[0]=e.editorActor,b[1]=t):t=b[1];let S=t.context.keyGenerator;b[2]!==e.editorActor?(n=e.editorActor.getSnapshot().matches({"edit mode":"read only"}),b[2]=e.editorActor,b[3]=n):n=b[3],b[4]!==e.editorActor?(i=e.editorActor.getSnapshot(),b[4]=e.editorActor,b[5]=i):i=b[5],b[6]!==_||b[7]!==t.context.keyGenerator||b[8]!==n||b[9]!==i.context.schema?(r={input:{keyGenerator:S,readOnly:n,schema:i.context.schema,slateEditor:_}},b[6]=_,b[7]=t.context.keyGenerator,b[8]=n,b[9]=i.context.schema,b[10]=r):r=b[10];let N=(0,s.TH)(td,r);b[11]!==x?(o=x.getSnapshot(),b[11]=x,b[12]=o):o=b[12],b[13]!==_||b[14]!==o.context.schema?(a={input:{schema:o.context.schema,slateEditor:_}},b[13]=_,b[14]=o.context.schema,b[15]=a):a=b[15];let T=(0,s.TH)(eh,a);return b[16]!==x||b[17]!==T||b[18]!==N?(l=()=>{let e=T.on("*",e=>{"has pending patches"===e.type&&N.send({type:"has pending patches"}),"mutation"===e.type&&(N.send({type:"mutation"}),x.send({type:"mutation",patches:e.patches,snapshot:e.snapshot,value:e.snapshot}))});return()=>{e.unsubscribe()}},c=[T,N,x],b[16]=x,b[17]=T,b[18]=N,b[19]=l,b[20]=c):(l=b[19],c=b[20]),(0,h.useEffect)(l,c),b[21]!==e.editorActor||b[22]!==N?(p=()=>{let t=N.on("*",t=>{e.editorActor.send(t)});return()=>{t.unsubscribe()}},d=[e.editorActor,N],b[21]=e.editorActor,b[22]=N,b[23]=d,b[24]=p):(d=b[23],p=b[24]),(0,h.useEffect)(p,d),b[25]!==E||b[26]!==N?(u=()=>{N.send({type:"update readOnly",readOnly:E})},f=[N,E],b[25]=E,b[26]=N,b[27]=u,b[28]=f):(u=b[27],f=b[28]),(0,h.useEffect)(u,f),b[29]!==N||b[30]!==w?(g=()=>{tf("Value from props changed, syncing new value"),N.send({type:"update value",value:w})},m=[N,w],b[29]=N,b[30]=w,b[31]=g,b[32]=m):(g=b[31],m=b[32]),(0,h.useEffect)(g,m),b[33]!==x||b[34]!==T?(k=()=>{tf("Subscribing to patch events");let e=x.on("patch",e=>{T.send(e)});return()=>{tf("Unsubscribing to patch events"),e.unsubscribe()}},b[33]=x,b[34]=T,b[35]=k):k=b[35],b[36]!==x||b[37]!==T||b[38]!==_?(v=[x,T,_],b[36]=x,b[37]=T,b[38]=_,b[39]=v):v=b[39],(0,h.useEffect)(k,v),null}function tg(e){return e.matches({"edit mode":"read only"})}function tm(e){return e.context.value}ty.displayName="Synchronizer";let tk=j("operationToPatches"),tv=new WeakMap;function tb(e,t){let n=tx(e);tv.set(e,!0),t(),tv.set(e,n)}function tx(e){return tv.get(e)??!1}let t_=j("applyPatches"),tw=t_.enabled&&!0;function tE(e){return"object"==typeof e&&"_key"in e}function tS(e,t){tw&&(t_(`Children ${t}:`,JSON.stringify(e.children,null,2)),t_(`Selection ${t}: `,JSON.stringify(e.selection,null,2)))}function tN(e,t){let{block:n,path:i}=function(e,t){let n=-1,i=e.children.find((e,i)=>{let r=tE(t[0])?e._key===t[0]._key:i===t[0];return r&&(n=i),r});return i?{block:i,path:[n]}:{}}(e,t);if(!(p.W_.isElement(n)&&"children"===t[1]))return{block:n,blockPath:i,child:void 0,childPath:void 0};let r=-1,o=n.children.find((e,n)=>{let i=tE(t[2])?e._key===t[2]._key:n===t[2];return i&&(r=n),i});return o?{block:n,child:o,blockPath:i,childPath:i?.concat(r)}:{block:n,blockPath:i,child:void 0,childPath:void 0}}let tT=j("plugin:withPatches"),tA=j("plugin:withPlaceholderBlock"),tR=j("plugin:withPortableTextBlockStyle");function tM(e){return"span"===e._type&&"text"in e&&"string"==typeof e.text&&(typeof e.marks>"u"||Array.isArray(e.marks)&&e.marks.every(e=>"string"==typeof e))}function tB({editor:e,blockPath:t,spanPath:n}){let i;for(let[r,o]of p.NB.children(e,t,{reverse:!0}))if(e.isTextSpan(r)&&p.y$.isBefore(o,n)){i=r;break}return i}function tC({editor:e,blockPath:t,spanPath:n}){let i;for(let[r,o]of p.NB.children(e,t))if(e.isTextSpan(r)&&p.y$.isAfter(o,n)){i=r;break}return i}let tD=j("plugin:withPortableTextMarkModel"),tP=({action:e})=>{let t=e.editor,n=e.decorator;if(t.selection){if(p.e6.isExpanded(t.selection)){p.YR.setNodes(t,{},{match:p.xv.isText,split:!0,hanging:!0});let e=p.e6.isRange(t.selection)?[...p.ML.nodes(t,{at:t.selection,match:p.xv.isText})]:[];e.length>1&&e.every(e=>e[0].marks?.includes(n))?t.removeMark(n):e.forEach(([e,i])=>{let r=[...(Array.isArray(e.marks)?e.marks:[]).filter(e=>e!==n),n];p.YR.setNodes(t,{marks:r},{at:i,match:p.xv.isText,split:!0,hanging:!0})})}else{let[e,i]=p.ML.node(t,t.selection,{depth:1}),r=t.isTextBlock(e)&&1===e.children.length&&t.isTextSpan(e.children[0])&&""===e.children[0].text?e.children[0]:void 0;if(r){let e=r.marks??[],o=e.filter(e=>e!==n);p.YR.setNodes(t,{marks:e.length===o.length?[...e,n]:o},{at:i,match:e=>t.isTextSpan(e)})}else{let e={...p.ML.marks(t)||{}}.marks||[],i={...p.ML.marks(t)||{},marks:[...e,n]};t.marks=i}}if(t.selection){let e=t.selection;t.selection={...e}}}},tO=({action:e})=>{let t=e.editor,n=e.decorator,{selection:i}=t;if(i){if(p.e6.isExpanded(i))p.YR.setNodes(t,{},{match:p.xv.isText,split:!0,hanging:!0}),t.selection&&[...p.ML.nodes(t,{at:t.selection,match:p.xv.isText})].forEach(([e,i])=>{let r=t.children[i[0]];p.W_.isElement(r)&&r.children.includes(e)&&p.YR.setNodes(t,{marks:(Array.isArray(e.marks)?e.marks:[]).filter(e=>e!==n),_type:"span"},{at:i})});else{let[e,r]=p.ML.node(t,i,{depth:1}),o=t.isTextBlock(e)&&1===e.children.length&&t.isTextSpan(e.children[0])&&""===e.children[0].text?e.children[0]:void 0;if(o){let e=(o.marks??[]).filter(e=>e!==n);p.YR.setNodes(t,{marks:e},{at:r,match:e=>t.isTextSpan(e)})}else{let e={...p.ML.marks(t)||{}}.marks||[],i={...p.ML.marks(t)||{},marks:e.filter(e=>e!==n)};t.marks={marks:i.marks,_type:"span"}}}if(t.selection){let e=t.selection;t.selection={...e}}}};function tj({editor:e,decorator:t}){if(!e.selection)return!1;let n=Array.from(p.ML.nodes(e,{match:p.xv.isText,at:e.selection}));return 0!==n.length&&(p.e6.isExpanded(e.selection)?n.every(e=>{let[n]=e;return n.marks?.includes(t)}):(({...p.ML.marks(e)||{}}).marks||[]).includes(t))}j("plugin:withPortableTextSelections");let tL=j("plugin:withSchemaTypes"),t$=j("plugin:withUtils"),tY=(e,t)=>{var n;let i;let{editorActor:r}=t,a=r.getSnapshot().context.schema,l=function(e){let t=e.block.name;return{insertNodePatch:function(e,n,i){let r=i[n.path[0]],o=e.isTextBlock(r);if(1===n.path.length){let e=0===n.path[0]?"before":"after",o=i[n.path[0]-1],a=0===n.path[0]?r?._key:o?._key;return a?[(0,w.$T)([F([n.node],t)[0]],e,[{_key:a}])]:[(0,w.Cb)(i,[]),(0,w.$T)([F([n.node],t)[0]],"before",[n.path[0]])]}if(o&&2===n.path.length&&e.children[n.path[0]]){let e=0!==r.children.length&&r.children[n.path[1]-1]?"after":"before",i={...n.node};!i._type&&p.xv.isText(i)&&(i._type="span",i.marks=[]);let o=F([{_key:"bogus",_type:t,children:[i]}],t)[0].children[0];return[(0,w.$T)([o],e,[{_key:r._key},"children",r.children.length<=1||!r.children[n.path[1]-1]?0:{_key:r.children[n.path[1]-1]._key}])]}return tk("Something was inserted into a void block. Not producing editor patches."),[]},insertTextPatch:function(e,t,n){tk.enabled&&tk("Operation",JSON.stringify(t,null,2));let i=e.isTextBlock(e.children[t.path[0]])&&e.children[t.path[0]];if(!i)throw Error("Could not find block");let r=e.isTextBlock(i)&&e.isTextSpan(i.children[t.path[1]])&&i.children[t.path[1]];if(!r)throw Error("Could not find child");let o=[{_key:i._key},"children",{_key:r._key},"text"],a=n[t.path[0]],l=e.isTextBlock(a)&&a.children[t.path[1]],s=e.isTextSpan(l)?l.text:"",c=(0,w.aH)(s,r.text,o);return c.value.length?[c]:[]},mergeNodePatch:function(e,n,i){let r=[],o=i[n.path[0]],a=e.children[n.path[0]];if(1===n.path.length){if(o?._key){let i=F([e.children[n.path[0]-1]],t)[0];r.push((0,w.t8)(i,[{_key:i._key}])),r.push((0,w.zN)([{_key:o._key}]))}else throw Error("Target key not found!")}else if(e.isTextBlock(o)&&e.isTextBlock(a)&&2===n.path.length){let t=a.children[n.path[1]-1]&&e.isTextSpan(a.children[n.path[1]-1])?a.children[n.path[1]-1]:void 0,i=o.children[n.path[1]]&&e.isTextSpan(o.children[n.path[1]])?o.children[n.path[1]]:void 0;t&&(1===o.children.filter(e=>e._key===t._key).length?r.push((0,w.t8)(t.text,[{_key:o._key},"children",{_key:t._key},"text"])):console.warn(`Multiple spans have \`_key\` ${t._key}. It's ambiguous which one to update.`,JSON.stringify(o,null,2))),i&&(1===o.children.filter(e=>e._key===i._key).length?r.push((0,w.zN)([{_key:o._key},"children",{_key:i._key}])):console.warn(`Multiple spans have \`_key\` ${i._key}. It's ambiguous which one to remove.`,JSON.stringify(o,null,2)))}else tk("Void nodes can't be merged, not creating any patches");return r},moveNodePatch:function(e,n,i){let r=[],o=i[n.path[0]],a=i[n.newPath[0]];if(!a)return r;if(1===n.path.length){let e=n.path[0]>n.newPath[0]?"before":"after";r.push((0,w.zN)([{_key:o._key}])),r.push((0,w.$T)([F([o],t)[0]],e,[{_key:a._key}]))}else if(2===n.path.length&&e.isTextBlock(o)&&e.isTextBlock(a)){let e=o.children[n.path[1]],i=a.children[n.newPath[1]],l=n.newPath[1]===a.children.length?"after":"before",s=F([o],t)[0].children[n.path[1]];r.push((0,w.zN)([{_key:o._key},"children",{_key:e._key}])),r.push((0,w.$T)([s],l,[{_key:a._key},"children",{_key:i._key}]))}return r},removeNodePatch:function(e,t,n){let i=n[t.path[0]];if(1===t.path.length){if(i&&i._key)return[(0,w.zN)([{_key:i._key}])];throw Error("Block not found")}if(!e.isTextBlock(i)||2!==t.path.length)return tk("Not creating patch inside object block"),[];{let e=i.children[t.path[1]];return e?i.children.filter(e=>e._key===t.node._key).length>1?(console.warn(`Multiple spans have \`_key\` ${t.node._key}. It's ambiguous which one to remove.`,JSON.stringify(i,null,2)),[]):[(0,w.zN)([{_key:i._key},"children",{_key:e._key}])]:(tk("Span not found in editor trying to remove node"),[])}},removeTextPatch:function(e,t,n){let i=e&&e.children[t.path[0]];if(!i)throw Error("Could not find block");let r=e.isTextBlock(i)&&i.children[t.path[1]]||void 0,o=e.isTextSpan(r)?r:void 0;if(r&&!o)throw Error("Expected span");if(!o)throw Error("Could not find child");let a=[{_key:i._key},"children",{_key:o._key},"text"],l=n[t.path[0]],s=e.isTextBlock(l)&&l.children[t.path[1]],c=e.isTextSpan(s)&&s.text,d=(0,w.aH)(c||"",o.text,a);return d.value?[d]:[]},setNodePatch:function(e,n){if(1===n.path.length){let i=e.children[n.path[0]];if("string"!=typeof i._key)throw Error("Expected block to have a _key");let r=A({...e.children[n.path[0]],...n.newProperties},T);return[(0,w.t8)(F([r],t)[0],[{_key:i._key}])]}if(2===n.path.length){let t=e.children[n.path[0]];if(e.isTextBlock(t)){let e=t.children[n.path[1]];if(e){let i=t._key,r=e._key,o=[],a=Object.keys(n.newProperties);return a.forEach(l=>{if(1===a.length&&"_key"===l){let r=N(n.newProperties,l);o.push((0,w.t8)(r,[{_key:i},"children",t.children.indexOf(e),l]))}else{let e=N(n.newProperties,l);o.push((0,w.t8)(e,[{_key:i},"children",{_key:r},l]))}}),o}throw Error("Could not find a valid child")}throw Error("Could not find a valid block")}throw Error(`Unexpected path encountered: ${JSON.stringify(n.path)}`)},splitNodePatch:function(e,n,i){let r=[],o=e.children[n.path[0]];if(!e.isTextBlock(o))throw Error(`Block with path ${JSON.stringify(n.path[0])} is not a text block and can't be split`);if(1===n.path.length){let a=i[n.path[0]];if(e.isTextBlock(a)){let i=F([e.children[n.path[0]+1]],t)[0];i&&(r.push((0,w.$T)([i],"after",[{_key:o._key}])),a.children.slice(n.position).forEach(e=>{let t=[{_key:a._key},"children",{_key:e._key}];r.push((0,w.zN)(t))}))}return r}if(2===n.path.length){let i=o.children[n.path[1]];if(e.isTextSpan(i)){let e=F([{...o,children:o.children.slice(n.path[1]+1,n.path[1]+2)}],t)[0].children;r.push((0,w.$T)(e,"after",[{_key:o._key},"children",{_key:i._key}])),r.push((0,w.t8)(i.text,[{_key:o._key},"children",{_key:i._key},"text"]))}}return r}}}(a),s=function({editorActor:e,schemaTypes:t}){return function(n){n.isTextBlock=e=>(0,o.DG)(e)&&e._type===t.block.name,n.isTextSpan=e=>(0,o.NG)(e)&&e._type===t.span.name,n.isListBlock=e=>(0,o.KA)(e)&&e._type===t.block.name,n.isVoid=e=>t.block.name!==e._type&&(t.blockObjects.map(e=>e.name).includes(e._type)||t.inlineObjects.map(e=>e.name).includes(e._type)),n.isInline=e=>t.inlineObjects.map(e=>e.name).includes(e._type)&&"__inline"in e&&!0===e.__inline;let{normalizeNode:i}=n;return n.normalizeNode=r=>{let[o,a]=r;if(void 0===o._type&&2===a.length){tL("Setting span type on text node without a type");let i=o._key||e.getSnapshot().context.keyGenerator();e.send({type:"normalizing"}),p.YR.setNodes(n,{...o,_type:t.span.name,_key:i},{at:a}),e.send({type:"done normalizing"});return}if(void 0===o._key&&(1===a.length||2===a.length)){tL("Setting missing key on child node without a key");let t=e.getSnapshot().context.keyGenerator();e.send({type:"normalizing"}),p.YR.setNodes(n,{_key:t},{at:a}),e.send({type:"done normalizing"});return}i(r)},n}}({editorActor:r,schemaTypes:a}),d=function({editorActor:e,patchFunctions:t,schemaTypes:n,subscriptions:i}){let r;let o=(e,t)=>{let i=!1;tw&&(t_(`

NEW PATCH =============================================================`),t_(JSON.stringify(t,null,2)));try{switch(t.type){case"insert":i=function(e,t,n){let{block:i,child:r,blockPath:o,childPath:a}=tN(e,t.path);if(!i||!o)return t_("Block not found"),!1;if(t.path.length>1&&"children"!==t.path[1])return t_("Ignoring patch targeting void value"),!1;if(1===t.path.length){let{items:i,position:r}=t,a=U(i,{schemaTypes:n},X.get(e)),l=o[0],s="after"===r?l+1:l;return t_(`Inserting blocks at path [${s}]`),tS(e,"before"),p.YR.insertNodes(e,a,{at:[s]}),tS(e,"after"),!0}let{items:l,position:s}=t;if(!r||!a)return t_("Child not found"),!1;let c=i&&U([{...i,children:l}],{schemaTypes:n},X.get(e)),d=a[1],h=[a[0],"after"===s?d+1:d];return t_(`Inserting children at path ${h}`),tS(e,"before"),c&&p.W_.isElement(c[0])&&p.YR.insertNodes(e,c[0].children,{at:h}),tS(e,"after"),!0}(e,t,n);break;case"unset":i=function(e,t){if(0===t.path.length){t_("Removing everything"),tS(e,"before");let t=e.selection;return p.YR.deselect(e),e.children.forEach((t,n)=>{p.YR.removeNodes(e,{at:[n]})}),p.YR.insertNodes(e,e.pteCreateTextBlock({decorators:[]})),t&&p.YR.select(e,{anchor:{path:[0,0],offset:0},focus:{path:[0,0],offset:0}}),e.onChange(),tS(e,"after"),!0}let{block:n,blockPath:i,child:r,childPath:o}=tN(e,t.path);if(1===t.path.length){if(!n||!i)return t_("Block not found"),!1;let t=i[0];return t_(`Removing block at path [${t}]`),tS(e,"before"),p.YR.removeNodes(e,{at:[t]}),tS(e,"after"),!0}return!!e.isTextBlock(n)&&"children"===t.path[1]&&3===t.path.length&&(r&&o?(t_(`Unsetting child at path ${JSON.stringify(o)}`),tS(e,"before"),tw&&t_(`Removing child at path ${JSON.stringify(o)}`),p.YR.removeNodes(e,{at:o}),tS(e,"after"),!0):(t_("Child not found"),!1))}(e,t);break;case"set":i=function(e,t){let n=t.value;"string"==typeof t.path[3]&&((n={})[t.path[3]]=t.value);let{block:i,blockPath:r,child:o,childPath:a}=tN(e,t.path);if(!i)return t_("Block not found"),!1;let l=e.isTextBlock(i);if(l&&t.path.length>1&&"children"!==t.path[1])return t_("Ignoring setting void value"),!1;if(tS(e,"before"),l&&o&&a){if(p.xv.isText(n)&&p.xv.isText(o)){let t=o.text;n.text!==t&&(t_("Setting text property"),e.apply({type:"remove_text",path:a,offset:0,text:t}),e.apply({type:"insert_text",path:a,offset:0,text:n.text}),e.onChange())}else t_("Setting non-text property"),e.apply({type:"set_node",path:a,properties:{},newProperties:n});return!0}if(p.W_.isElement(i)&&1===t.path.length&&r){t_("Setting block property");let{children:t,...o}=n,{children:a,...l}=i||{children:void 0};e.apply({type:"set_node",path:r,properties:{...l},newProperties:o}),t_("Setting children"),i.children.forEach((t,n)=>{e.apply({type:"remove_node",path:r.concat(i.children.length-1-n),node:t})}),Array.isArray(t)&&t.forEach((t,n)=>{e.apply({type:"insert_node",path:r.concat(n),node:t})})}else if(i&&"value"in i){let n=(0,w.g7)([i.value],[t])[0];return p.YR.setNodes(e,{...i,value:n},{at:r}),!0}return tS(e,"after"),!0}(e,t);break;case"diffMatchPatch":i=function(e,t){let{block:n,child:i,childPath:r}=tN(e,t.path);if(!n)return t_("Block not found"),!1;if(!i||!r)return t_("Child not found"),!1;if(!(n&&e.isTextBlock(n)&&4===t.path.length&&"children"===t.path[1]&&"text"===t.path[3])||!p.xv.isText(i))return!1;let[o]=function(e,t,n={}){if("string"==typeof e)throw Error("Patches must be an array - pass the patch to `parsePatch()` first");let i=t;if(0===e.length)return[i,[]];let r=function(e,t,n={}){let i=0,r=0;function o(e){for(;i<e;){let e=t.codePointAt(r);if(typeof e>"u")return r;i+=eQ(e),e>65535?r+=2:r+=1}if(!n.allowExceedingIndices&&i!==e)throw Error("Failed to determine byte offset");return r}let a=[];for(let t of e)a.push({diffs:t.diffs.map(e=>em(e)),start1:o(t.start1),start2:o(t.start2),utf8Start1:t.utf8Start1,utf8Start2:t.utf8Start2,length1:t.length1,length2:t.length2,utf8Length1:t.utf8Length1,utf8Length2:t.utf8Length2});return a}(e,i,{allowExceedingIndices:n.allowExceedingIndices}),o=n.margin||4,a=n.deleteThreshold||.4,l=function(e,t=4){let n="";for(let e=1;e<=t;e++)n+=String.fromCharCode(e);for(let n of e)n.start1+=t,n.start2+=t,n.utf8Start1+=t,n.utf8Start2+=t;let i=e[0],r=i.diffs;if(0===r.length||0!==r[0][0])r.unshift([0,n]),i.start1-=t,i.start2-=t,i.utf8Start1-=t,i.utf8Start2-=t,i.length1+=t,i.length2+=t,i.utf8Length1+=t,i.utf8Length2+=t;else if(t>r[0][1].length){let e=r[0][1].length,o=t-e;r[0][1]=n.substring(e)+r[0][1],i.start1-=o,i.start2-=o,i.utf8Start1-=o,i.utf8Start2-=o,i.length1+=o,i.length2+=o,i.utf8Length1+=o,i.utf8Length2+=o}if(0===(r=(i=e[e.length-1]).diffs).length||0!==r[r.length-1][0])r.push([0,n]),i.length1+=t,i.length2+=t,i.utf8Length1+=t,i.utf8Length2+=t;else if(t>r[r.length-1][1].length){let e=t-r[r.length-1][1].length;r[r.length-1][1]+=n.substring(0,e),i.length1+=e,i.length2+=e,i.utf8Length1+=e,i.utf8Length2+=e}return n}(r,o);i=l+i+l,function(e,t=4){for(let n=0;n<e.length;n++){if(e[n].length1<=32)continue;let i=e[n];e.splice(n--,1);let r=i.start1,o=i.start2,a="";for(;0!==i.diffs.length;){let l=e0(r-a.length,o-a.length),s=!0;if(""!==a){let e=eX(a);l.length1=a.length,l.utf8Length1=e,l.length2=a.length,l.utf8Length2=e,l.diffs.push([0,a])}for(;0!==i.diffs.length&&l.length1<32-t;){let e=i.diffs[0][0],n=i.diffs[0][1],a=eX(n);if(1===e){l.length2+=n.length,l.utf8Length2+=a,o+=n.length;let e=i.diffs.shift();e&&l.diffs.push(e),s=!1}else -1===e&&1===l.diffs.length&&0===l.diffs[0][0]&&n.length>64?(l.length1+=n.length,l.utf8Length1+=a,r+=n.length,s=!1,l.diffs.push([e,n]),i.diffs.shift()):(a=eX(n=n.substring(0,32-l.length1-t)),l.length1+=n.length,l.utf8Length1+=a,r+=n.length,0===e?(l.length2+=n.length,l.utf8Length2+=a,o+=n.length):s=!1,l.diffs.push([e,n]),n===i.diffs[0][1]?i.diffs.shift():i.diffs[0][1]=i.diffs[0][1].substring(n.length))}a=(a=eJ(l.diffs)).substring(a.length-t);let c=eq(i.diffs).substring(0,t),d=eX(c);""!==c&&(l.length1+=c.length,l.length2+=c.length,l.utf8Length1+=d,l.utf8Length2+=d,0!==l.diffs.length&&0===l.diffs[l.diffs.length-1][0]?l.diffs[l.diffs.length-1][1]+=c:l.diffs.push([0,c])),s||e.splice(++n,0,l)}}}(r,o);let s=0,c=[];for(let e=0;e<r.length;e++){let t=r[e].start2+s,n=eq(r[e].diffs),o,l=-1;if(n.length>32?-1!==(o=eH(i,n.substring(0,32),t))&&(-1===(l=eH(i,n.substring(n.length-32),t+n.length-32))||o>=l)&&(o=-1):o=eH(i,n,t),-1===o)c[e]=!1,s-=r[e].length2-r[e].length1;else{let d;if(c[e]=!0,s=o-t,d=-1===l?i.substring(o,o+n.length):i.substring(o,l+32),n===d)i=i.substring(0,o)+eJ(r[e].diffs)+i.substring(o+n.length);else{let t=eR(n,d,{checkLines:!1});if(n.length>32&&function(e){let t=0,n=0,i=0;for(let r=0;r<e.length;r++){let o=e[r][0],a=e[r][1];switch(o){case 1:n+=a.length;break;case -1:i+=a.length;break;case 0:t+=Math.max(n,i),n=0,i=0;break;default:throw Error("Unknown diff operation.")}}return t+Math.max(n,i)}(t)/n.length>a)c[e]=!1;else{t=eY(t);let n=0,a=0;for(let l=0;l<r[e].diffs.length;l++){let s=r[e].diffs[l];0!==s[0]&&(a=eZ(t,n)),1===s[0]?i=i.substring(0,o+a)+s[1]+i.substring(o+a):-1===s[0]&&(i=i.substring(0,o+a)+i.substring(o+eZ(t,n+s[1].length))),-1!==s[0]&&(n+=s[1].length)}}}}}return[i=i.substring(l.length,i.length-l.length),c]}(e2(t.value),i.text,{allowExceedingIndices:!0}),a=function(e,t=4){let n=e.map(e=>em(e)),i=!1,r=[],o=0,a=null,l=0,s=!1,c=!1,d=!1,h=!1;for(;l<n.length;)0===n[l][0]?(n[l][1].length<t&&(d||h)?(r[o++]=l,s=d,c=h,a=n[l][1]):(o=0,a=null),d=!1,h=!1):(-1===n[l][0]?h=!0:d=!0,a&&(s&&c&&d&&h||a.length<t/2&&3===function(...e){return e.reduce((e,t)=>e+(t?1:0),0)}(s,c,d,h))&&(n.splice(r[o-1],0,[-1,a]),n[r[o-1]+1][0]=1,o--,a=null,s&&c?(d=!0,h=!0,o=0):(l=--o>0?r[o-1]:-1,d=!1,h=!1),i=!0)),l++;return i&&(n=ez(n)),n}(eR(i.text,o),5);tS(e,"before");let l=0;for(let[t,n]of a)1===t?(e.apply({type:"insert_text",path:r,offset:l,text:n}),l+=n.length):-1===t?e.apply({type:"remove_text",path:r,offset:l,text:n}):0===t&&(l+=n.length);return tS(e,"after"),!0}(e,t);break;default:t_("Unhandled patch",t.type)}}catch(e){console.error(e)}return i};return function(a){K.set(a,!1),ey.set(a,!0),r=[...a.children];let{apply:l}=a,s=[],c=()=>{if(0===s.length)return;let e=s;s=[];let t=!1;eu(a,()=>{p.ML.withoutNormalizing(a,()=>{eg(a,()=>{ts(a,()=>{e.forEach(e=>{tT.enabled&&tT(`Handling remote patch ${JSON.stringify(e)}`),t=o(a,e)})})})}),t&&(a.normalize(),a.onChange())})},d=({patches:e})=>{let t=e.filter(e=>"local"!==e.origin);0!==t.length&&(s=s.concat(t),c())};return i.push(()=>{tT("Subscribing to remote patches");let t=e.on("patches",d);return()=>{tT("Unsubscribing to remote patches"),t.unsubscribe()}}),a.apply=i=>{let o=[],s=W(r=a.children,n);l(i);let c=W(a.children,n);if(!ey.get(a))return a;switch(s&&!c&&"set_selection"!==i.type&&o.push((0,w.$T)(r,"before",[0])),i.type){case"insert_text":o=[...o,...t.insertTextPatch(a,i,r)];break;case"remove_text":o=[...o,...t.removeTextPatch(a,i,r)];break;case"remove_node":o=[...o,...t.removeNodePatch(a,i,r)];break;case"split_node":o=[...o,...t.splitNodePatch(a,i,r)];break;case"insert_node":o=[...o,...t.insertNodePatch(a,i,r)];break;case"set_node":o=[...o,...t.setNodePatch(a,i,r)];break;case"merge_node":o=[...o,...t.mergeNodePatch(a,i,r)];break;case"move_node":o=[...o,...t.moveNodePatch(a,i,r)]}return!s&&c&&["merge_node","set_node","remove_text","remove_node"].includes(i.type)&&(o=[...o,(0,w.zN)([])],e.send({type:"unset",previousValue:F(r,n.block.name,Q.get(a))})),s&&o.length>0&&(o=[(0,w.Cb)([],[]),...o]),o.length>0&&o.forEach(t=>{e.send({type:"patch",patch:{...t,origin:"local"}})}),a},a}}({editorActor:r,patchFunctions:l,schemaTypes:a,subscriptions:t.subscriptions}),h=function(e){let{editorActor:t,blockSchemaType:n}=e;return i=>{let r=F(i.children,n.name),o=tn(i);e.subscriptions.push(()=>{e9("Subscribing to patches");let e=t.on("patches",({patches:e,snapshot:t})=>{let n=!1;e.forEach(e=>{if(!n&&"local"!==e.origin&&o){if("unset"===e.type&&0===e.path.length){e9("Someone else cleared the content, resetting undo/redo history"),i.history={undos:[],redos:[]},o.splice(0,o.length),e7.set(i,!0),n=!0;return}o.push({patch:e,time:new Date,snapshot:t,previousSnapshot:r})}}),r=t});return()=>{e9("Unsubscribing to patches"),e.unsubscribe()}}),i.history={undos:[],redos:[]};let{apply:a}=i;return i.apply=e=>{if(t.getSnapshot().matches({"edit mode":"read only"})||ef(i)||e6(i)||e5(i)){a(e);return}let{operations:n,history:r}=i,{undos:o}=r,l=o[o.length-1],s=l&&l.operations&&l.operations[l.operations.length-1],c=ta(e,s),d=tt(i),h=!0;if(d){if(l?0===n.length&&(h=to(e,s)||c):h=!1,l&&h)l.operations.push(e);else{let t={operations:[...null===i.selection?[]:[{type:"set_selection",properties:{...i.selection},newProperties:{...i.selection}}],e],timestamp:new Date};o.push(t),e9("Created new undo step",l)}for(;o.length>1e3;)o.shift();tl(e)&&(r.redos=[])}a(e)},i.undo=()=>{if(t.getSnapshot().matches({"edit mode":"read only"}))return;let{undos:e}=i.history;if(e.length>0){let t=e[e.length-1];if(e9("Undoing",t),t.operations.length>0){let e=o.filter(e=>e.time>=t.timestamp),n=t.operations;e.forEach(e=>{n=E(n.map(t=>ti(i,e.patch,t,e.snapshot,e.previousSnapshot)))});let r=n.map(p.OX.inverse).reverse();try{p.ML.withoutNormalizing(i,()=>{(function(e,t){let n=e6(e);e8.set(e,!0),t(),e8.set(e,n)})(i,()=>{ts(i,()=>{r.forEach(e=>{i.apply(e)})})})}),i.normalize(),i.onChange()}catch(e){e9("Could not perform undo step",e),o.splice(0,o.length),p.YR.deselect(i),i.history={undos:[],redos:[]},e7.set(i,!0),e8.set(i,!1),i.onChange();return}i.history.redos.push(t),i.history.undos.pop()}}},i.redo=()=>{if(t.getSnapshot().matches({"edit mode":"read only"}))return;let{redos:e}=i.history;if(e.length>0){let t=e[e.length-1];if(e9("Redoing",t),t.operations.length>0){let e=o.filter(e=>e.time>=t.timestamp),n=t.operations;e.forEach(e=>{n=E(n.map(t=>ti(i,e.patch,t,e.snapshot,e.previousSnapshot)))});try{p.ML.withoutNormalizing(i,()=>{(function(e,t){let n=e5(e);e4.set(e,!0),t(),e4.set(e,n)})(i,()=>{ts(i,()=>{n.forEach(e=>{i.apply(e)})})})}),i.normalize(),i.onChange()}catch(e){e9("Could not perform redo step",e),o.splice(0,o.length),p.YR.deselect(i),i.history={undos:[],redos:[]},e7.set(i,!0),e4.set(i,!1),i.onChange();return}i.history.undos.push(t),i.history.redos.pop()}}},i}}({editorActor:r,blockSchemaType:a.block,subscriptions:t.subscriptions}),u=function(e,t){let n=t.styles[0].value;return function(t){let{normalizeNode:i}=t;return t.normalizeNode=r=>{let[,o]=r;for(let i of t.operations)if("split_node"===i.type&&1===i.path.length&&t.isTextBlock(i.properties)&&i.properties.style!==n&&i.path[0]===o[0]&&!p.y$.equals(o,i.path)){let[r]=p.ML.node(t,[i.path[0]+1,0]);if(p.xv.isText(r)&&""===r.text){tR(`Normalizing split node to ${n} style`,i),e.send({type:"normalizing"}),p.YR.setNodes(t,{style:n},{at:[i.path[0]+1],voids:!1}),e.send({type:"done normalizing"});return}}i(r)},t}}(r,a),f=function({editorActor:e,schemaTypes:t}){return function(n){return n.pteExpandToWord=()=>{let{selection:e}=n;if(e&&!p.e6.isExpanded(e)){let[t]=p.ML.node(n,e.focus,{depth:2});if(!t||!p.xv.isText(t)||0===t.text.length){t$("pteExpandToWord: Can't expand to word here");return}let{focus:i}=e,r=i.offset,o=t.text.slice(0,r),a=t.text.slice(r,-1),l=e=>e.match(/\s/g),s=o.split("").reverse().findIndex(e=>l(e)),c=s>-1?o.length-s:0,d=a.split("").findIndex(e=>l(e)),h=o.length+(d>-1?d:a.length+1);if(!(c===h||Number.isNaN(c)||Number.isNaN(h))){t$("pteExpandToWord: Expanding to focused word"),p.YR.setSelection(n,{anchor:{...e.anchor,offset:c},focus:{...e.focus,offset:h}});return}t$("pteExpandToWord: Can't expand to word here")}},n.pteCreateTextBlock=n=>U([{_type:t.block.name,_key:e.getSnapshot().context.keyGenerator(),style:t.styles[0].value||"normal",...n.listItem?{listItem:n.listItem}:{},...n.level?{level:n.level}:{},markDefs:[],children:[{_type:"span",_key:e.getSnapshot().context.keyGenerator(),text:"",marks:n.decorators.filter(e=>t.decorators.find(({value:t})=>t===e))}]}],{schemaTypes:t})[0],n}}({editorActor:r,schemaTypes:a}),y=(i=null,function(e){let t=()=>{if(i!==e.selection){let t=null;if(e.selection){let n=ee.get(e.selection);n?t=n:(t=Y(e.children,e.selection,a),ee.set(e.selection,t))}t?r.send({type:"selection",selection:t}):r.send({type:"selection",selection:null})}i=e.selection},{onChange:n}=e;return e.onChange=()=>{n(),r.getSnapshot().matches({setup:"setting up"})||t()},e});return(n=t.subscriptions,function(e){if(void 0!==r.getSnapshot().context.maxBlocks)return e;n.push(()=>{let t=r.on("*",t=>{switch(t.type){case"annotation.add":r.send({type:"behavior event",behaviorEvent:{type:"annotation.add",annotation:t.annotation},editor:e});break;case"annotation.remove":r.send({type:"behavior event",behaviorEvent:{type:"annotation.remove",annotation:t.annotation},editor:e});break;case"blur":r.send({type:"behavior event",behaviorEvent:{type:"blur"},editor:e});break;case"custom.*":r.send({type:"custom behavior event",behaviorEvent:t.event,editor:e});break;case"decorator.toggle":r.send({type:"behavior event",behaviorEvent:{type:"decorator.toggle",decorator:t.decorator},editor:e});break;case"focus":r.send({type:"behavior event",behaviorEvent:{type:"focus"},editor:e});break;case"insert.block object":r.send({type:"behavior event",behaviorEvent:{type:"insert.block object",placement:t.placement,blockObject:t.blockObject},editor:e});break;case"insert.inline object":r.send({type:"behavior event",behaviorEvent:{type:"insert.inline object",inlineObject:t.inlineObject},editor:e});break;case"list item.toggle":r.send({type:"behavior event",behaviorEvent:{type:"list item.toggle",listItem:t.listItem},editor:e});break;case"select":r.send({type:"behavior event",behaviorEvent:{type:"select",selection:t.selection},editor:e});break;case"style.toggle":r.send({type:"behavior event",behaviorEvent:{type:"style.toggle",style:t.style},editor:e})}});return()=>{t.unsubscribe()}});let{deleteBackward:t,deleteForward:i,insertBreak:o,insertSoftBreak:a,insertText:l,select:s}=e;return e.deleteBackward=n=>{if(tx(e)){t(n);return}r.send({type:"behavior event",behaviorEvent:{type:"delete.backward",unit:n},editor:e})},e.deleteForward=t=>{if(tx(e)){i(t);return}r.send({type:"behavior event",behaviorEvent:{type:"delete.forward",unit:t},editor:e})},e.insertBreak=()=>{if(tx(e)){o();return}r.send({type:"behavior event",behaviorEvent:{type:"insert.break"},editor:e})},e.insertSoftBreak=()=>{if(tx(e)){a();return}r.send({type:"behavior event",behaviorEvent:{type:"insert.soft break"},editor:e})},e.insertText=(t,n)=>{if(tx(e)){l(t,n);return}r.send({type:"behavior event",behaviorEvent:{type:"insert.text",text:t,options:n},editor:e,defaultActionCallback:()=>{l(t,n)}})},e.select=t=>{if(tx(e)){s(t);return}let n=p.ML.range(e,t);r.send({type:"behavior event",behaviorEvent:{type:"select",selection:Y(F(e.children,r.getSnapshot().context.schema.block.name,Q.get(e)),n,r.getSnapshot().context.schema)},editor:e,defaultActionCallback:()=>{s(t)}})},e})(s(function(e){let{apply:t,normalizeNode:n}=e;return e.apply=n=>{if(ef(e)||e6(e)||e5(e)){t(n);return}if("split_node"===n.type){t({...n,properties:{...n.properties,_key:r.getSnapshot().context.keyGenerator()}});return}if("insert_node"===n.type&&!p.ML.isEditor(n.node)){t({...n,node:{...n.node,_key:r.getSnapshot().context.keyGenerator()}});return}t(n)},e.normalizeNode=t=>{let[i,o]=t;if(p.W_.isElement(i)&&i._type===a.block.name){if(!i._key){r.send({type:"normalizing"}),p.YR.setNodes(e,{_key:r.getSnapshot().context.keyGenerator()},{at:o}),r.send({type:"done normalizing"});return}for(let[t,n]of p.NB.children(e,o))if(!t._key){r.send({type:"normalizing"}),p.YR.setNodes(e,{_key:r.getSnapshot().context.keyGenerator()},{at:n}),r.send({type:"done normalizing"});return}}n(t)},e}(function(e){let{apply:t,normalizeNode:n}=e,i=a.decorators.map(e=>e.value);return e.normalizeNode=t=>{let[i,o]=t;if(e.isTextBlock(i))for(let[t,n]of p.NB.children(e,o)){let o=i.children[n[1]+1];if(e.isTextSpan(t)&&e.isTextSpan(o)&&t.marks?.every(e=>o.marks?.includes(e))&&o.marks?.every(e=>t.marks?.includes(e))){tD("Merging spans",JSON.stringify(t,null,2),JSON.stringify(o,null,2)),r.send({type:"normalizing"}),p.YR.mergeNodes(e,{at:[n[0],n[1]+1],voids:!0}),r.send({type:"done normalizing"});return}}if(e.isTextBlock(i)&&!Array.isArray(i.markDefs)){tD("Adding .markDefs to block node"),r.send({type:"normalizing"}),p.YR.setNodes(e,{markDefs:[]},{at:o}),r.send({type:"done normalizing"});return}if(e.isTextSpan(i)&&!Array.isArray(i.marks)){tD("Adding .marks to span node"),r.send({type:"normalizing"}),p.YR.setNodes(e,{marks:[]},{at:o}),r.send({type:"done normalizing"});return}if(e.isTextSpan(i)){let t=p.y$.parent(o),[n]=p.ML.node(e,t),l=a.decorators.map(e=>e.value),s=i.marks?.filter(e=>!l.includes(e));if(e.isTextBlock(n)&&""===i.text&&s&&s.length>0){tD("Removing annotations from empty span node"),r.send({type:"normalizing"}),p.YR.setNodes(e,{marks:i.marks?.filter(e=>l.includes(e))},{at:o}),r.send({type:"done normalizing"});return}}if(e.isTextBlock(i)){let t=a.decorators.map(e=>e.value);for(let[n,a]of p.NB.children(e,o))if(e.isTextSpan(n)){let o=n.marks??[],l=o.filter(e=>!t.includes(e)&&!i.markDefs?.find(t=>t._key===e));if(l.length>0){tD("Removing orphaned annotations from span node"),r.send({type:"normalizing"}),p.YR.setNodes(e,{marks:o.filter(e=>!l.includes(e))},{at:a}),r.send({type:"done normalizing"});return}}}if(e.isTextSpan(i)){let t=p.y$.parent(o),[n]=p.ML.node(e,t);if(e.isTextBlock(n)){let t=a.decorators.map(e=>e.value),l=i.marks??[],s=l.filter(e=>!t.includes(e)&&!n.markDefs?.find(t=>t._key===e));if(s.length>0){tD("Removing orphaned annotations from span node"),r.send({type:"normalizing"}),p.YR.setNodes(e,{marks:l.filter(e=>!s.includes(e))},{at:o}),r.send({type:"done normalizing"});return}}}if(e.isTextBlock(i)){let t=i.markDefs??[],n=new Set,a=[];for(let e of t)n.has(e._key)||(n.add(e._key),a.push(e));if(t.length!==a.length){tD("Removing duplicate markDefs"),r.send({type:"normalizing"}),p.YR.setNodes(e,{markDefs:a},{at:o}),r.send({type:"done normalizing"});return}}if(e.isTextBlock(i)&&!e.operations.some(e=>"merge_node"===e.type&&"markDefs"in e.properties&&1===e.path.length)){let t=(i.markDefs||[]).filter(e=>i.children.find(t=>p.xv.isText(t)&&Array.isArray(t.marks)&&t.marks.includes(e._key)));if(i.markDefs&&!c(t,i.markDefs)){tD("Removing markDef not in use"),r.send({type:"normalizing"}),p.YR.setNodes(e,{markDefs:t},{at:o}),r.send({type:"done normalizing"});return}}n(t)},e.apply=n=>{if(ef(e)||e6(e)||e5(e)){t(n);return}if("set_selection"===n.type&&p.ML.marks(e)&&n.properties&&n.newProperties&&n.properties.anchor&&n.properties.focus&&n.newProperties.anchor&&n.newProperties.focus){let t=p.e6.isCollapsed({anchor:n.properties.anchor,focus:n.properties.focus}),i=p.e6.isCollapsed({anchor:n.newProperties.anchor,focus:n.newProperties.focus});if(t&&i){let t=Array.from(p.ML.nodes(e,{mode:"lowest",at:n.properties.focus,match:t=>e.isTextSpan(t),voids:!1}))[0]?.[0],i=Array.from(p.ML.nodes(e,{mode:"lowest",at:n.newProperties.focus,match:t=>e.isTextSpan(t),voids:!1}))[0]?.[0],r=t&&i&&n.newProperties.focus.path[0]===n.properties.focus.path[0]&&n.newProperties.focus.path[1]===n.properties.focus.path[1]+1&&t.text.length===n.properties.focus.offset&&0===n.newProperties.focus.offset,o=t&&i&&n.newProperties.focus.path[0]===n.properties.focus.path[0]&&n.newProperties.focus.path[1]===n.properties.focus.path[1]-1&&0===n.properties.focus.offset&&i.text.length===n.newProperties.focus.offset;if(r||o)return}}if("insert_node"===n.type){let{selection:t}=e;if(t){let[r,o]=p.ML.node(e,t,{depth:1}),a=tB({editor:e,blockPath:o,spanPath:n.path}),l=a?a.marks?.filter(e=>!i.includes(e)):[],s=tC({editor:e,blockPath:o,spanPath:[n.path[0],n.path[1]-1]}),c=s?s.marks?.filter(e=>!i.includes(e)):[],d=l?.filter(e=>!c?.includes(e))??[],h=d.length>0;if(h&&tM(n.node)&&n.node.marks?.some(e=>d.includes(e))){p.YR.insertNodes(e,{...n.node,marks:n.node.marks?.filter(e=>!d.includes(e))??[]});return}let u=c?.filter(e=>!l?.includes(e))??[],f=u.length>0;if(f&&tM(n.node)&&n.node.marks?.some(e=>u.includes(e))){p.YR.insertNodes(e,{...n.node,marks:n.node.marks?.filter(e=>!u.includes(e))??[]});return}let y=s?.marks?.filter(e=>i.includes(e))??[];if(y.length>0&&h&&!f&&tM(n.node)&&n.node.marks?.length===0){p.YR.insertNodes(e,{...n.node,marks:y});return}}}if("insert_text"===n.type){let{selection:o}=e,a=!!o&&p.e6.isCollapsed(o);if(o&&a){let[a,l]=p.ML.node(e,o,{depth:1}),[s,c]=Array.from(p.ML.nodes(e,{mode:"lowest",at:o.focus,match:t=>e.isTextSpan(t),voids:!1}))[0]??[void 0,void 0],d=s.marks??[],h=d.filter(e=>i.includes(e)),u=d.length>h.length,f=0===s.text.length,y=0===o.anchor.offset,g=o.anchor.offset===s.text.length,m=tB({editor:e,blockPath:l,spanPath:c}),k=tC({editor:e,blockPath:l,spanPath:c}),v=k?.marks?.filter(e=>!i.includes(e))??[],b=d.filter(e=>!i.includes(e)),x=!!m&&m.marks?.some(e=>!i.includes(e)),_=!!m&&m.marks?.filter(e=>!i.includes(e)).every(e=>d.includes(e)),w=!!m&&m.marks?.some(e=>!i.includes(e)&&d.includes(e)),E=!!m&&m.marks?.every(e=>d.includes(e)),S=b.some(e=>v?.includes(e));if(u&&!f){if(y){if(E||_){p.YR.insertNodes(e,{_type:"span",_key:r.getSnapshot().context.keyGenerator(),text:n.text,marks:m?.marks??[]});return}if(w){t(n);return}if(!m){p.YR.insertNodes(e,{_type:"span",_key:r.getSnapshot().context.keyGenerator(),text:n.text,marks:[]});return}}if(g){if(k&&S&&v.length<b.length||!S){p.YR.insertNodes(e,{_type:"span",_key:r.getSnapshot().context.keyGenerator(),text:n.text,marks:k?.marks??[]});return}if(!k){p.YR.insertNodes(e,{_type:"span",_key:r.getSnapshot().context.keyGenerator(),text:n.text,marks:[]});return}}}if(y&&!f&&m){p.YR.insertNodes(e,{_type:"span",_key:r.getSnapshot().context.keyGenerator(),text:n.text,marks:x?[]:(m.marks??[]).filter(e=>i.includes(e))});return}}}if("remove_text"===n.type){let{selection:r}=e;if(r&&p.e6.isExpanded(r)){var o;let[a,l]=p.ML.node(e,r,{depth:1}),[s,c]=Array.from(p.ML.nodes(e,{mode:"lowest",at:{path:n.path,offset:n.offset},match:t=>e.isTextSpan(t),voids:!1}))[0]??[void 0,void 0];if(s&&a&&"string"==typeof(o=a)._type&&"@"!==o._type[0]&&(!("markDefs"in o)||!o.markDefs||Array.isArray(o.markDefs)&&o.markDefs.every(e=>"string"==typeof e._key))&&"children"in o&&Array.isArray(o.children)&&o.children.every(e=>"object"==typeof e&&"_type"in e)){let r=a.markDefs??[],o=s.marks??[],d=o.some(e=>r.find(t=>t._key===e)),h=n.offset+n.text.length===s.text.length,u=0===n.offset&&h,f=tB({editor:e,blockPath:l,spanPath:c}),y=tC({editor:e,blockPath:l,spanPath:c}),g=!!f&&f.marks?.some(e=>!i.includes(e)&&o.includes(e)),m=!!y&&y.marks?.some(e=>!i.includes(e)&&o.includes(e));if(d&&u&&!g&&!m){let r=(({...p.ML.marks(e)||{}}).marks||[]).filter(e=>i.includes(e));p.ML.withoutNormalizing(e,()=>{t(n),p.YR.setNodes(e,{marks:r},{at:n.path})}),e.onChange();return}}}}if("merge_node"===n.type&&1===n.path.length&&"markDefs"in n.properties&&n.properties._type===a.block.name&&Array.isArray(n.properties.markDefs)&&n.properties.markDefs.length>0&&n.path[0]-1>=0){let[i,r]=p.ML.node(e,[n.path[0]-1]);if(e.isTextBlock(i)){let o=g([...Array.isArray(i.markDefs)&&i.markDefs||[],...n.properties.markDefs]);tD("Copying markDefs over to merged block",n),p.YR.setNodes(e,{markDefs:o},{at:r,voids:!1}),t(n);return}}t(n)},e}(u(function(e){let{apply:t}=e;return e.apply=n=>{if(r.getSnapshot().matches({"edit mode":"read only"})||ef(e)||e6(e)||e5(e)){t(n);return}if("remove_node"===n.type){let t=n.node;if(0===n.path[0]&&p.ML.isVoid(e,t)){let t=p.y$.next(n.path);e.children[t[0]]||(tA("Adding placeholder block"),p.ML.insertNode(e,e.pteCreateTextBlock({decorators:[]})))}}t(n)},e}(f(function(e){let{apply:t}=e;return e.apply=n=>{if(r.getSnapshot().matches({"edit mode":"read only"})||ef(e)||e6(e)||e5(e)){t(n);return}let i=r.getSnapshot().context.maxBlocks??-1;i>0&&e.children.length>=i&&("insert_node"===n.type||"split_node"===n.type)&&1===n.path.length||t(n)},e}(h(d(y(e)))))))))))},tz=j("component:PortableTextEditor:SlateContainer"),tI=new WeakMap,tG=({context:e,action:t})=>{if(!t.editor.selection)return;let n=(0,R.Fb)(e);for(let[,e]of[...p.ML.nodes(t.editor,{at:t.editor.selection,match:e=>n.isListBlock(e)})])p.YR.unsetNodes(t.editor,["listItem","level"],{at:e})},tV=({context:e,action:t})=>{if(!t.editor.selection)return;let n=(0,R.Fb)(e);for(let[,e]of[...p.ML.nodes(t.editor,{at:t.editor.selection,match:e=>n.isTextBlock(e)})])p.YR.setNodes(t.editor,{level:1,listItem:t.listItem},{at:e})};function tU({editor:e,listItem:t}){if(!e.selection)return!1;let n=[...p.ML.nodes(e,{at:e.selection,match:t=>e.isTextBlock(t)})];return n.length>0&&n.every(([n])=>e.isListBlock(n)&&n.listItem===t)}let tF=({context:e,action:t})=>{if(!t.editor.selection)return;let n=e.schema.styles[0].value,i=(0,R.Fb)(e);for(let[,e]of[...p.ML.nodes(t.editor,{at:t.editor.selection,match:e=>i.isTextBlock(e)})])p.YR.setNodes(t.editor,{style:n},{at:e})},tW=({context:e,action:t})=>{if(!t.editor.selection)return;let n=(0,R.Fb)(e);for(let[,e]of[...p.ML.nodes(t.editor,{at:t.editor.selection,match:e=>n.isTextBlock(e)})])p.YR.setNodes(t.editor,{style:t.style},{at:e})};function tK({editor:e,style:t}){if(!e.selection)return!1;let n=[...p.ML.nodes(e,{at:e.selection,match:t=>e.isTextBlock(t)})];return n.length>0&&n.every(([e])=>e.style===t)}let tH=j("API:editable");function tq({editor:e,annotation:t}){if(!e.selection||e.selection.focus.path.length<2)return!1;try{let n=[...p.ML.nodes(e,{at:e.selection,match:e=>p.xv.isText(e)})];if(0===n.length||n.some(([e])=>!(0,o.NG)(e)||!e.marks||e.marks?.length===0))return!1;let i=n.reduce((t,[,n])=>{let[i]=p.ML.node(e,n,{depth:1});return e.isTextBlock(i)&&i.markDefs?[...t,...i.markDefs]:t},[]);return n.every(([e])=>!!(0,o.NG)(e)&&e.marks?.map(e=>i.find(t=>t?._key===e)?._type)?.includes(t.name))}catch{return!1}}let tJ=({context:e,action:t})=>{let n;let i=t.editor,{selection:r}=i;if(r&&(p.e6.isCollapsed(r)&&(i.pteExpandToWord(),i.onChange()),i.selection)){let r,o;let a=[];if(!i.selection)return;for(let[n,l]of p.ML.nodes(i,{at:i.selection,match:e=>i.isTextBlock(e),reverse:p.e6.isBackward(i.selection)})){if(0===n.children.length||1===n.children.length&&""===n.children[0].text)continue;let s=e.keyGenerator(),c=n.markDefs??[];for(let[e,d]of(void 0===c.find(e=>e._type===t.annotation.name&&e._key===s)&&(p.YR.setNodes(i,{markDefs:[...c,{_type:t.annotation.name,_key:s,...t.annotation.value}]},{at:l}),o=[{_key:n._key},"markDefs",{_key:s}],p.e6.isBackward(i.selection)?a.unshift(o):a.push(o)),p.YR.setNodes(i,{},{match:p.xv.isText,split:!0}),p.NB.children(i,l))){if(!i.isTextSpan(e)||!p.e6.includes(i.selection,d))continue;let o=e.marks??[],a=o.filter(e=>c.some(n=>n._key===e&&n._type===t.annotation.name));p.YR.setNodes(i,{marks:[...o.filter(e=>!a.includes(e)),s]},{at:d}),r=[{_key:n._key},"children",{_key:e._key}]}}o&&r&&(n={markDefPath:o,markDefPaths:a,spanPath:r})}return n},tZ=({action:e})=>{let t=e.editor;if(tH("Removing annotation",e.annotation.name),t.selection){if(p.e6.isCollapsed(t.selection)){let[n,i]=p.ML.node(t,t.selection,{depth:1});if(!t.isTextBlock(n))return;let r=(n.markDefs??[]).filter(t=>t._type===e.annotation.name),[o,a]=p.ML.node(t,t.selection,{depth:2});if(!t.isTextSpan(o))return;let l=o.marks?.find(e=>r.some(t=>t._key===e));if(!l)return;let s=[];for(let[e,n]of p.NB.children(t,i,{reverse:!0}))if(t.isTextSpan(e)&&p.y$.isBefore(n,a)){if(e.marks?.includes(l))s.push([e,n]);else break}let c=[];for(let[e,n]of p.NB.children(t,i))if(t.isTextSpan(e)&&p.y$.isAfter(n,a)){if(e.marks?.includes(l))c.push([e,n]);else break}for(let[e,n]of[...s,[o,a],...c])p.YR.setNodes(t,{marks:e.marks?.filter(e=>e!==l)},{at:n})}else for(let[n,i]of(p.YR.setNodes(t,{},{match:e=>t.isTextSpan(e),split:!0,hanging:!0}),p.ML.nodes(t,{at:t.selection,match:e=>t.isTextBlock(e)})))for(let[r,o]of p.NB.children(t,i)){if(!t.isTextSpan(r)||!p.e6.includes(t.selection,o))continue;let i=n.markDefs??[],a=r.marks??[],l=a.filter(t=>i.find(e=>e._key===t)?._type!==e.annotation.name);l.length!==a.length&&p.YR.setNodes(t,{marks:l},{at:o})}}};function tX({block:e,placement:t,editor:n,schema:i}){if(n.selection){let[r,o]=Array.from(p.ML.nodes(n,{at:n.selection.focus.path.slice(0,1),match:e=>!p.ML.isEditor(e)}))[0]??[void 0,void 0];if("after"===t){let t=[o[0]+1];p.YR.insertNodes(n,e,{at:t}),p.YR.select(n,{anchor:{path:[t[0],0],offset:0},focus:{path:[t[0],0],offset:0}})}else"before"===t?p.YR.insertNodes(n,e,{at:o}):p.ML.insertNode(n,e);r&&W([r],i)&&p.YR.removeNodes(n,{at:o})}else{let t=Array.from(p.ML.nodes(n,{match:e=>!p.ML.isEditor(e),at:[],reverse:!0}))[0];p.ML.insertNode(n,e),t&&W([t[0]],i)&&p.YR.removeNodes(n,{at:t[1]})}}let tQ=({context:e,action:t})=>{let n=e.keyGenerator,i=e.schema,r=t.editor;if(!r.selection)return;let[o]=Array.from(p.ML.nodes(r,{mode:"lowest",at:r.selection.focus,match:e=>r.isTextSpan(e),voids:!1}))[0]??[void 0],a=o?.marks?.filter(e=>i.decorators.some(t=>t.value===e))??[],l=o?.marks?.filter(e=>!i.decorators.some(t=>t.value===e))??[],s=r.selection.anchor.path.slice(0,1),d=r.selection.focus.path.slice(0,1),h=p.NB.descendant(r,d);if(r.isTextBlock(h)){let[e,t]=p.e6.edges(r.selection),o=h.children[h.children.length-1],u=c(e,{path:[...d,h.children.length-1],offset:r.isTextSpan(o)?o.text.length:0}),f=c(t,{path:[...d,0],offset:0});if(u&&p.e6.isCollapsed(r.selection)){p.ML.insertNode(r,r.pteCreateTextBlock({decorators:[],listItem:h.listItem,level:h.level}));return}if(f&&p.e6.isCollapsed(r.selection)){p.ML.insertNode(r,r.pteCreateTextBlock({decorators:0===l.length?a:[],listItem:h.listItem,level:h.level}));let[e]=p.y$.next(d);p.YR.select(r,{anchor:{path:[e,0],offset:0},focus:{path:[e,0],offset:0}});return}let y=s[0]!==d[0];if(!f&&!u&&!y){p.ML.withoutNormalizing(r,()=>{if(!r.selection)return;p.YR.splitNodes(r,{at:r.selection});let[e,t]=p.ML.node(r,p.y$.next(d),{depth:1});if(p.YR.setSelection(r,{anchor:{path:[...t,0],offset:0},focus:{path:[...t,0],offset:0}}),r.isTextBlock(e)&&e.markDefs&&e.markDefs.length>0){let o=new Map,a=Array.from(p.NB.children(r,d)).map(e=>e[0]).filter(e=>r.isTextSpan(e));for(let[e,l]of p.NB.children(r,t)){if(!r.isTextSpan(e))continue;let t=e.marks??[];for(let e of t)i.decorators.some(t=>t.value===e)||a.some(t=>t.marks?.includes(e))&&!o.has(e)&&o.set(e,n());let s=t.map(e=>o.get(e)??e);c(t,s)||p.YR.setNodes(r,{marks:s},{at:l})}let l=e.markDefs.map(e=>({...e,_key:o.get(e._key)??e._key}));c(e.markDefs,l)||p.YR.setNodes(r,{markDefs:l},{at:t,match:e=>r.isTextBlock(e)})}}),r.onChange();return}}p.YR.splitNodes(r,{always:!0})},t0={"annotation.add":tJ,"annotation.remove":tZ,"annotation.toggle":({context:e,action:t})=>{if(!tq({editor:t.editor,annotation:{name:t.annotation.name}}))return tJ({context:e,action:{type:"annotation.add",annotation:t.annotation,editor:t.editor}});tZ({context:e,action:{type:"annotation.remove",annotation:t.annotation,editor:t.editor}})},blur:({action:e})=>{u.F3.blur(e.editor)},"decorator.add":tP,"decorator.remove":tO,"decorator.toggle":({context:e,action:t})=>{tj({editor:t.editor,decorator:t.decorator})?tO({context:e,action:{type:"decorator.remove",editor:t.editor,decorator:t.decorator}}):tP({context:e,action:{type:"decorator.add",editor:t.editor,decorator:t.decorator}})},focus:({action:e})=>{u.F3.focus(e.editor)},"delete.backward":({action:e})=>{(0,p.j)(e.editor,e.unit)},"delete.forward":({action:e})=>{(0,p.Kb)(e.editor,e.unit)},"delete.block":({action:e})=>{let t=z({anchor:{path:e.blockPath,offset:0},focus:{path:e.blockPath,offset:0}},e.editor);if(!t){console.error("Unable to find Slate range from selection points");return}p.YR.removeNodes(e.editor,{at:t})},"delete.text":({context:e,action:t})=>{let n=F(t.editor.children,e.schema.block.name,Q.get(t.editor)),i=(0,M.MR)({value:n,blockOffset:t.anchor}),r=(0,M.MR)({value:n,blockOffset:t.focus});if(!i||!r){console.error("Unable to find anchor or focus selection point");return}let o=z({anchor:i,focus:r},t.editor);if(!o){console.error("Unable to find Slate range from selection points");return}p.YR.delete(t.editor,{at:o})},"insert.block object":({context:e,action:t})=>{tX({block:U([{_key:e.keyGenerator(),_type:t.blockObject.name,...t.blockObject.value?t.blockObject.value:{}}],{schemaTypes:e.schema})[0],placement:t.placement,editor:t.editor,schema:e.schema})},"insert.break":tQ,"insert.inline object":({context:e,action:t})=>{if(!e.schema.inlineObjects.some(e=>e.name===t.inlineObject.name)){console.error("Unable to insert unknown inline object");return}if(!t.editor.selection){console.error("Unable to insert inline object without selection");return}let[n]=Array.from(p.ML.nodes(t.editor,{at:t.editor.selection.focus.path,match:e=>t.editor.isTextBlock(e)})).at(0)??[void 0,void 0];if(!n){console.error("Unable to perform action without focus text block");return}let i=U([{_type:e.schema.block.name,_key:e.keyGenerator(),children:[{_type:t.inlineObject.name,_key:e.keyGenerator(),...t.inlineObject.value??{}}]}],{schemaTypes:e.schema}).at(0)?.children.at(0);if(!i){console.error("Unable to insert inline object");return}p.YR.insertNodes(t.editor,i)},"insert.soft break":({context:e,action:t})=>{tQ({context:e,action:{...t,type:"insert.break"}})},"insert.span":({context:e,action:t})=>{if(!t.editor.selection){console.error("Unable to perform action without selection",t);return}let[n,i]=Array.from(p.ML.nodes(t.editor,{at:t.editor.selection.focus.path,match:e=>t.editor.isTextBlock(e)}))[0]??[void 0,void 0];if(!n||!i){console.error("Unable to perform action without focus block",t);return}let r=n.markDefs??[],o=t.annotations?t.annotations.map(t=>({_type:t.name,_key:e.keyGenerator(),...t.value})):void 0;o&&o.length>0&&p.YR.setNodes(t.editor,{markDefs:[...r,...o]}),p.YR.insertNodes(t.editor,{_type:"span",_key:e.keyGenerator(),text:t.text,marks:[...o?.map(e=>e._key)??[],...t.decorators??[]]})},"insert.text":({action:e})=>{(0,p.Om)(e.editor,e.text)},"insert.text block":({context:e,action:t})=>{tX({block:U([{_key:e.keyGenerator(),_type:e.schema.block.name,style:e.schema.styles[0].value??"normal",markDefs:[],children:t.textBlock?.children?.map(t=>({...t,_key:e.keyGenerator()}))??[{_type:e.schema.span.name,_key:e.keyGenerator(),text:""}]}],{schemaTypes:e.schema})[0],editor:t.editor,schema:e.schema,placement:t.placement})},effect:({action:e})=>{e.effect()},"list item.add":tV,"list item.remove":tG,"list item.toggle":({context:e,action:t})=>{tU({editor:t.editor,listItem:t.listItem})?tG({context:e,action:{...t,type:"list item.remove"}}):tV({context:e,action:{...t,type:"list item.add"}})},"move.block":({action:e})=>{let t=[$(e.at,e.editor)[0]],n=[$(e.to,e.editor)[0]];p.YR.moveNodes(e.editor,{at:t,to:n,mode:"highest"})},"move.block down":({action:e})=>{let t=[$(e.at,e.editor)[0]],n=[p.y$.next(t)[0]];p.YR.moveNodes(e.editor,{at:t,to:n,mode:"highest"})},"move.block up":({action:e})=>{let t=[$(e.at,e.editor)[0]];if(!p.y$.hasPrevious(t))return;let n=[p.y$.previous(t)[0]];p.YR.moveNodes(e.editor,{at:t,to:n,mode:"highest"})},select:({action:e})=>{let t=z(e.selection,e.editor);t?p.YR.select(e.editor,t):p.YR.deselect(e.editor)},"select.previous block":({action:e})=>{if(!e.editor.selection){console.error("Unable to select previous block without a selection");return}let t=e.editor.selection.focus.path.slice(0,1);if(!p.y$.hasPrevious(t)){console.error("There's no previous block to select");return}let n=p.y$.previous(t);p.YR.select(e.editor,n)},"select.next block":({action:e})=>{if(!e.editor.selection){console.error("Unable to select next block without a selection");return}let t=[e.editor.selection.focus.path.slice(0,1)[0]+1];p.YR.select(e.editor,t)},"style.toggle":({context:e,action:t})=>{tK({editor:t.editor,style:t.style})?tF({context:e,action:{...t,type:"style.remove"}}):tW({context:e,action:{...t,type:"style.add"}})},"style.add":tW,"style.remove":tF,"text block.set":({action:e})=>{let t=z({anchor:{path:e.at,offset:0},focus:{path:e.at,offset:0}},e.editor);p.YR.setNodes(e.editor,{...e.style?{style:e.style}:{},...e.listItem?{listItem:e.listItem}:{},...e.level?{level:e.level}:{}},{at:t})},"text block.unset":({action:e})=>{let t=z({anchor:{path:e.at,offset:0},focus:{path:e.at,offset:0}},e.editor);p.YR.unsetNodes(e.editor,e.props,{at:t})}};function t1({context:e,action:t}){switch(t.type){case"annotation.toggle":t0["annotation.toggle"]({context:e,action:t});break;case"decorator.add":t0["decorator.add"]({context:e,action:t});break;case"decorator.remove":t0["decorator.remove"]({context:e,action:t});break;case"delete.block":t0["delete.block"]({context:e,action:t});break;case"delete.text":t0["delete.text"]({context:e,action:t});break;case"insert.span":t0["insert.span"]({context:e,action:t});break;case"insert.text block":t0["insert.text block"]({context:e,action:t});break;case"list item.add":t0["list item.add"]({context:e,action:t});break;case"list item.remove":t0["list item.remove"]({context:e,action:t});break;case"move.block":t0["move.block"]({context:e,action:t});break;case"move.block down":t0["move.block down"]({context:e,action:t});break;case"move.block up":t0["move.block up"]({context:e,action:t});break;case"noop":break;case"effect":t0.effect({context:e,action:t});break;case"select":t0.select({context:e,action:t});break;case"select.previous block":t0["select.previous block"]({context:e,action:t});break;case"select.next block":t0["select.next block"]({context:e,action:t});break;case"style.add":t0["style.add"]({context:e,action:t});break;case"style.remove":t0["style.remove"]({context:e,action:t});break;case"text block.set":t0["text block.set"]({context:e,action:t});break;case"text block.unset":t0["text block.unset"]({context:e,action:t});break;default:!function({context:e,action:t}){switch(t.type){case"annotation.add":t0["annotation.add"]({context:e,action:t});break;case"annotation.remove":t0["annotation.remove"]({context:e,action:t});break;case"blur":t0.blur({context:e,action:t});break;case"decorator.toggle":t0["decorator.toggle"]({context:e,action:t});break;case"delete.backward":t0["delete.backward"]({context:e,action:t});break;case"delete.forward":t0["delete.forward"]({context:e,action:t});break;case"focus":t0.focus({context:e,action:t});break;case"insert.block object":t0["insert.block object"]({context:e,action:t});break;case"insert.inline object":t0["insert.inline object"]({context:e,action:t});break;case"insert.break":t0["insert.break"]({context:e,action:t});break;case"insert.soft break":t0["insert.soft break"]({context:e,action:t});break;case"insert.text":t0["insert.text"]({context:e,action:t});break;case"list item.toggle":t0["list item.toggle"]({context:e,action:t});break;case"select":t0.select({context:e,action:t});break;default:t0["style.toggle"]({context:e,action:t})}}({context:e,action:t})}}function t2({schema:e,slateEditorInstance:t}){let n=e.decorators.map(e=>e.value);return(({...p.ML.marks(t)??{}}).marks??[]).filter(e=>n.includes(e))}let t3=(0,v.cY)({types:{context:{},events:{},emitted:{},input:{}},actions:{"add behavior to context":(0,b.a)({behaviors:({context:e,event:t})=>((0,v.ZD)(t,"add behavior"),new Set([...e.behaviors,t.behavior]))}),"remove behavior from context":(0,b.a)({behaviors:({context:e,event:t})=>((0,v.ZD)(t,"remove behavior"),e.behaviors.delete(t.behavior),new Set([...e.behaviors]))}),"assign behaviors":(0,b.a)({behaviors:({event:e})=>((0,v.ZD)(e,"update behaviors"),new Set(e.behaviors))}),"assign schema":(0,b.a)({schema:({event:e})=>((0,v.ZD)(e,"update schema"),e.schema)}),"emit patch event":(0,b.e)(({event:e})=>((0,v.ZD)(e,"patch"),e)),"emit mutation event":(0,b.e)(({event:e})=>((0,v.ZD)(e,"mutation"),e)),"emit read only":(0,b.e)({type:"read only"}),"emit editable":(0,b.e)({type:"editable"}),"defer event":(0,b.a)({pendingEvents:({context:e,event:t})=>((0,v.ZD)(t,["patch","mutation"]),[...e.pendingEvents,t])}),"emit pending events":(0,b.b)(({context:e,enqueue:t})=>{for(let n of e.pendingEvents)t((0,b.e)(n))}),"emit ready":(0,b.e)({type:"ready"}),"clear pending events":(0,b.a)({pendingEvents:[]}),"handle behavior event":(0,b.b)(({context:e,event:t,enqueue:n})=>{(0,v.ZD)(t,["behavior event","custom behavior event"]);let i="custom behavior event"===t.type||"copy"===t.behaviorEvent.type||"key.down"===t.behaviorEvent.type||"key.up"===t.behaviorEvent.type||"paste"===t.behaviorEvent.type?void 0:{...t.behaviorEvent,editor:t.editor},r="behavior event"===t.type?t.defaultActionCallback:void 0,o=[...e.behaviors.values()].filter(e=>e.on===t.behaviorEvent.type);if(0===o.length){if(r){tb(t.editor,()=>{p.ML.withoutNormalizing(t.editor,()=>{try{r()}catch(e){console.error(Error(`Performing action "${t.behaviorEvent.type}" failed due to: ${e.message}`))}})});return}if(!i)return;tb(t.editor,()=>{p.ML.withoutNormalizing(t.editor,()=>{try{t1({context:e,action:i})}catch(e){console.error(Error(`Performing action "${i.type}" as a result of "${t.behaviorEvent.type}" failed due to: ${e.message}`))}})}),t.editor.onChange();return}let a=function({editor:e,keyGenerator:t,schema:n}){let i=F(e.children,n.block.name,Q.get(e)),r=Y(i,e.selection,n);return{context:{activeDecorators:t2({schema:n,slateEditorInstance:e}),keyGenerator:t,schema:n,selection:r,value:i}}}({editor:t.editor,keyGenerator:e.keyGenerator,schema:e.schema}),l=!1;for(let i of o){let r=void 0===i.guard||i.guard({context:a.context,event:t.behaviorEvent});if(r){for(let o of i.actions.map(e=>e({context:a.context,event:t.behaviorEvent},r)))l=l||o.length>0&&o.some(e=>"effect"!==e.type),tb(t.editor,()=>{p.ML.withoutNormalizing(t.editor,()=>{for(let i of o){if("raise"===i.type){(0,B.zW)(i.event)?n.raise({type:"custom behavior event",behaviorEvent:i.event,editor:t.editor}):n.raise({type:"behavior event",behaviorEvent:i.event,editor:t.editor});continue}let r={...i,editor:t.editor};try{t1({context:e,action:r})}catch(e){console.error(Error(`Performing action "${r.type}" as a result of "${t.behaviorEvent.type}" failed due to: ${e.message}`));break}}})}),t.editor.onChange();if(l){t.nativeEvent?.preventDefault();break}}}if(!l){if(r){tb(t.editor,()=>{p.ML.withoutNormalizing(t.editor,()=>{try{r()}catch(e){console.error(Error(`Performing "${t.behaviorEvent.type}" failed due to: ${e.message}`))}})});return}if(!i)return;tb(t.editor,()=>{p.ML.withoutNormalizing(t.editor,()=>{try{t1({context:e,action:i})}catch(e){console.error(Error(`Performing action "${i.type}" as a result of "${t.behaviorEvent.type}" failed due to: ${e.message}`))}})}),t.editor.onChange()}})}}).createMachine({id:"editor",context:({input:e})=>({behaviors:new Set(e.behaviors??B.Ux),keyGenerator:e.keyGenerator,pendingEvents:[],schema:e.schema,selection:null,initialReadOnly:e.readOnly??!1,maxBlocks:e.maxBlocks,value:e.value}),on:{"add behavior":{actions:"add behavior to context"},"remove behavior":{actions:"remove behavior from context"},unset:{actions:(0,b.e)(({event:e})=>e)},"value changed":{actions:(0,b.e)(({event:e})=>e)},"invalid value":{actions:(0,b.e)(({event:e})=>e)},error:{actions:(0,b.e)(({event:e})=>e)},selection:{actions:[(0,b.a)({selection:({event:e})=>e.selection}),(0,b.e)(({event:e})=>e)]},blurred:{actions:(0,b.e)(({event:e})=>e)},focused:{actions:(0,b.e)(({event:e})=>e)},loading:{actions:(0,b.e)({type:"loading"})},patches:{actions:(0,b.e)(({event:e})=>e)},"done loading":{actions:(0,b.e)({type:"done loading"})},"update behaviors":{actions:"assign behaviors"},"update schema":{actions:"assign schema"},"update value":{actions:(0,b.a)({value:({event:e})=>e.value})},"update maxBlocks":{actions:(0,b.a)({maxBlocks:({event:e})=>e.maxBlocks})}},type:"parallel",states:{"edit mode":{initial:"read only",states:{"read only":{initial:"determine initial edit mode",states:{"determine initial edit mode":{on:{"done syncing initial value":[{target:"#editor.edit mode.read only.read only",guard:({context:e})=>e.initialReadOnly},{target:"#editor.edit mode.editable"}]}},"read only":{on:{"update readOnly":{guard:({event:e})=>!e.readOnly,target:"#editor.edit mode.editable",actions:["emit editable"]}}}}},editable:{on:{"update readOnly":{guard:({event:e})=>e.readOnly,target:"#editor.edit mode.read only.read only",actions:["emit read only"]},"behavior event":{actions:"handle behavior event"},"custom behavior event":{actions:"handle behavior event"},"annotation.*":{actions:(0,b.e)(({event:e})=>e)},blur:{actions:(0,b.e)(({event:e})=>e)},"custom.*":{actions:(0,b.e)(({event:e})=>({type:"custom.*",event:e}))},"decorator.*":{actions:(0,b.e)(({event:e})=>e)},focus:{actions:(0,b.e)(({event:e})=>e)},"insert.*":{actions:(0,b.e)(({event:e})=>e)},"list item.*":{actions:(0,b.e)(({event:e})=>e)},select:{actions:(0,b.e)(({event:e})=>e)},"style.*":{actions:(0,b.e)(({event:e})=>e)}}}}},setup:{initial:"setting up",states:{"setting up":{exit:["emit ready"],on:{patch:{actions:"defer event"},mutation:{actions:"defer event"},"done syncing initial value":{target:"pristine"}}},pristine:{initial:"idle",states:{idle:{on:{normalizing:{target:"normalizing"},patch:{actions:"defer event",target:"#editor.setup.dirty"},mutation:{actions:"defer event",target:"#editor.setup.dirty"}}},normalizing:{on:{"done normalizing":{target:"idle"},patch:{actions:"defer event"},mutation:{actions:"defer event"}}}}},dirty:{entry:["emit pending events","clear pending events"],on:{patch:{actions:"emit patch event"},mutation:{actions:"emit mutation event"}}}}}}}),t8=()=>(function(e){let t=t4();return(function(e=16){let t=new Uint8Array(e);return(0,C.Z)(t),t})(12).reduce((e,n)=>e+t[n],"").slice(0,12)})(12),t4=()=>{if(i)return i;i=[];for(let e=0;e<256;++e)i[e]=(e+256).toString(16).slice(1);return i};function t6(e){return{behaviors:e.behaviors,keyGenerator:e.keyGenerator??t8,maxBlocks:e.maxBlocks,readOnly:e.readOnly,schema:e.schemaDefinition?function(e){let t=e?.blockObjects?.map(e=>o.fe({type:"object",name:"image"===e.name?"tmp-image":e.name,title:"image"===e.name&&void 0===e.title?"Image":e.title,fields:[]}))??[],n=e?.inlineObjects?.map(e=>o.fe({type:"object",name:e.name,title:e.title,fields:[]}))??[],i=(0,o.Z2)({type:"array",name:"portable-text",of:[...t.map(e=>({type:e.name})),{type:"block",name:"block",of:n.map(e=>({type:e.name})),marks:{decorators:e?.decorators?.map(e=>({title:e.title??a(e.name),value:e.name}))??[],annotations:e?.annotations?.map(e=>({name:e.name,type:"object",title:e.title}))??[]},lists:e?.lists?.map(e=>({value:e.name,title:e.title??a(e.name)}))??[],styles:e?.styles?.map(e=>({value:e.name,title:e.title??a(e.name)}))??[]}]}),l=P(r.V.compile({types:[i,...t,...n]}).get("portable-text"));return{...l,blockObjects:l.blockObjects.map(e=>"tmp-image"===e.name?{...e,name:"image",type:{...e.type,name:"image"}}:e)}}(e.schemaDefinition):P(e.schema.hasOwnProperty("jsonType")?e.schema:ed(e.schema)),value:e.initialValue}}function t5(e){let t=function(e){let t=tI.get(e.editorActor);if(t)return tz("Reusing existing Slate editor instance",e.editorActor.id),t;tz("Creating new Slate editor instance",e.editorActor.id);let n=[],i=[],r=tY((0,u.BU)((0,p.Jh)()),{editorActor:e.editorActor,subscriptions:i});for(let e of(Q.set(r,{}),X.set(r,{}),i))n.push(e());let o=[r.pteCreateTextBlock({decorators:[]})],a={instance:r,initialValue:o};return tI.set(e.editorActor,a),a}({editorActor:e});return{getSnapshot:()=>(function({editorActorSnapshot:e,slateEditorInstance:t}){return{context:{activeDecorators:t2({schema:e.context.schema,slateEditorInstance:t}),keyGenerator:e.context.keyGenerator,schema:e.context.schema,selection:e.context.selection,value:function({editorActorSnapshot:e,slateEditorInstance:t}){return F(t.children,e.context.schema.block.name,Q.get(t))}({editorActorSnapshot:e,slateEditorInstance:t})}}})({editorActorSnapshot:e.getSnapshot(),slateEditorInstance:t.instance}),registerBehavior:t=>(e.send({type:"add behavior",behavior:t.behavior}),()=>{e.send({type:"remove behavior",behavior:t.behavior})}),send:t=>{e.send(t)},on:(t,n)=>e.on(t,n),_internal:{editable:function(e,t){let n=t.getSnapshot().context.schema;return{focus:()=>{t.send({type:"behavior event",behaviorEvent:{type:"focus"},editor:e})},blur:()=>{t.send({type:"behavior event",behaviorEvent:{type:"blur"},editor:e})},toggleMark:n=>{t.send({type:"behavior event",behaviorEvent:{type:"decorator.toggle",decorator:n},editor:e})},toggleList:n=>{t.send({type:"behavior event",behaviorEvent:{type:"list item.toggle",listItem:n},editor:e})},toggleBlockStyle:n=>{t.send({type:"behavior event",behaviorEvent:{type:"style.toggle",style:n},editor:e})},isMarkActive:t=>{try{return tj({editor:e,decorator:t})}catch(e){return console.warn(e),!1}},marks:()=>({...p.ML.marks(e)||{}}).marks||[],undo:()=>e.undo(),redo:()=>e.redo(),select:t=>{let n=z(t,e);n?p.YR.select(e,n):p.YR.deselect(e),e.onChange()},focusBlock:()=>{if(e.selection){let t=p.NB.descendant(e,e.selection.focus.path.slice(0,1));if(t)return F([t],n.block.name,Q.get(e))[0]}},focusChild:()=>{if(e.selection){let t=p.NB.descendant(e,e.selection.focus.path.slice(0,1));if(t&&e.isTextBlock(t))return F([t],n.block.name,Q.get(e))[0].children[e.selection.focus.path[1]]}},insertChild:(i,r)=>{if(i.name!==n.span.name)return t.send({type:"behavior event",behaviorEvent:{type:"insert.inline object",inlineObject:{name:i.name,value:r}},editor:e}),Y(F(e.children,n.block.name,Q.get(e)),e.selection,n)?.focus.path??[];if(!e.selection)throw Error("The editor has no selection");let[o]=Array.from(p.ML.nodes(e,{at:e.selection.focus.path.slice(0,1),match:e=>e._type===n.block.name}))[0]||[void 0];if(!o)throw Error("No focused text block");if(i.name!==n.span.name&&!n.inlineObjects.some(e=>e.name===i.name))throw Error("This type cannot be inserted as a child to a text block");let a=U([{_key:t.getSnapshot().context.keyGenerator(),_type:n.block.name,children:[{_key:t.getSnapshot().context.keyGenerator(),_type:i.name,...r||{}}]}],{schemaTypes:t.getSnapshot().context.schema})[0].children[0],l=e.selection.focus.path.slice(0,2),s=a._type===n.span.name,c=p.NB.get(e,l);return s&&c._type!==n.span.name&&(tH("Inserting span child next to inline object child, moving selection + 1"),e.move({distance:1,unit:"character"})),p.YR.insertNodes(e,a,{select:!0,at:e.selection}),e.onChange(),Y(F(e.children,n.block.name,Q.get(e)),e.selection,n)?.focus.path||[]},insertBlock:(i,r)=>(t.send({type:"behavior event",behaviorEvent:{type:"insert.block object",blockObject:{name:i.name,value:r},placement:"auto"},editor:e}),Y(F(e.children,n.block.name,Q.get(e)),e.selection,n)?.focus.path??[]),hasBlockStyle:t=>{try{return tK({editor:e,style:t})}catch{return!1}},hasListStyle:t=>{try{return tU({editor:e,listItem:t})}catch{return!1}},isVoid:e=>![n.block.name,n.span.name].includes(e._type),findByPath:t=>{let i=z({focus:{path:t,offset:0},anchor:{path:t,offset:0}},e);if(i){let[r,o]=p.ML.node(e,i.focus.path.slice(0,1));if(r&&o&&"string"==typeof r._key){if(1===t.length&&1===i.focus.path.length)return[F([r],n.block.name)[0],[{_key:r._key}]];let o=F([r],n.block.name,Q.get(e))[0];if(e.isTextBlock(o)){let e=o.children[i.focus.path[1]];if(e)return[e,[{_key:r._key},"children",{_key:e._key}]]}}}return[void 0,void 0]},findDOMNode:t=>{let n;try{let[i]=Array.from(p.ML.nodes(e,{at:[],match:e=>e._key===t._key})||[])[0]||[void 0];n=u.F3.toDOMNode(e,i)}catch{}return n},activeAnnotations:()=>{if(!e.selection||e.selection.focus.path.length<2)return[];try{let t=[];for(let[n,i]of p.ML.nodes(e,{at:e.selection,match:e=>p.xv.isText(e)&&void 0!==e.marks&&Array.isArray(e.marks)&&e.marks.length>0})){let[r]=p.ML.node(e,i,{depth:1});e.isTextBlock(r)&&r.markDefs?.forEach(e=>{p.xv.isText(n)&&n.marks&&Array.isArray(n.marks)&&n.marks.includes(e._key)&&t.push(e)})}return t}catch{return[]}},isAnnotationActive:t=>tq({editor:e,annotation:{name:t}}),addAnnotation:(i,r)=>{let o;return p.ML.withoutNormalizing(e,()=>{o=tJ({context:{keyGenerator:t.getSnapshot().context.keyGenerator,schema:n},action:{type:"annotation.add",annotation:{name:i.name,value:r??{}},editor:e}})}),e.onChange(),o},delete:(t,i)=>{if(t){let r=z(t,e);if(!(r&&r.anchor.path.length>0&&r.focus.path.length>0))throw Error("Invalid range");if(r){if(!i?.mode||i?.mode==="selected"){tH("Deleting content in selection"),p.YR.delete(e,{at:r,hanging:!0,voids:!0}),e.onChange();return}i?.mode==="blocks"&&(tH("Deleting blocks touched by selection"),p.YR.removeNodes(e,{at:r,voids:!0,match:t=>e.isTextBlock(t)||!e.isTextBlock(t)&&p.W_.isElement(t)})),i?.mode==="children"&&(tH("Deleting children touched by selection"),p.YR.removeNodes(e,{at:r,voids:!0,match:t=>t._type===n.span.name||!e.isTextBlock(t)&&p.W_.isElement(t)})),0===e.children.length&&(e.children=[e.pteCreateTextBlock({decorators:[]})]),e.onChange()}}},removeAnnotation:n=>{t.send({type:"behavior event",behaviorEvent:{type:"annotation.remove",annotation:{name:n.name}},editor:e})},getSelection:()=>{let t=null;if(e.selection){let i=ee.get(e.selection);if(i)return i;t=Y(F(e.children,n.block.name,Q.get(e)),e.selection,n),ee.set(e.selection,t)}return t},getValue:()=>F(e.children,n.block.name,Q.get(e)),isCollapsedSelection:()=>!!e.selection&&p.e6.isCollapsed(e.selection),isExpandedSelection:()=>!!e.selection&&p.e6.isExpanded(e.selection),insertBreak:()=>{e.insertBreak(),e.onChange()},getFragment:()=>F(e.getFragment(),n.block.name),isSelectionsOverlapping:(t,n)=>{let i=z(t,e),r=z(n,e);return p.e6.isRange(i)&&p.e6.isRange(r)&&p.e6.includes(i,r)}}}(t.instance,e),editorActor:e,slateEditor:t}}}let t9=(0,h.createContext)({}),t7=(0,h.createContext)(null),ne=()=>{let e=(0,h.useContext)(t7);if(void 0===e)throw Error("The `usePortableTextEditorSelection` hook must be used inside the <PortableTextEditor> component's context.");return e},nt=j("component:PortableTextEditor:SelectionProvider");function nn(e){let t,n,i;let r=(0,y.c)(6),[o,a]=(0,h.useState)(null);return r[0]!==e.editorActor?(t=()=>{nt("Subscribing to selection changes");let t=e.editorActor.on("selection",e=>{(0,h.startTransition)(()=>{a(e.selection)})});return()=>{nt("Unsubscribing to selection changes"),t.unsubscribe()}},n=[e.editorActor],r[0]=e.editorActor,r[1]=t,r[2]=n):(t=r[1],n=r[2]),(0,h.useEffect)(t,n),r[3]!==e.children||r[4]!==o?(i=(0,l.jsx)(t7.Provider,{value:o,children:e.children}),r[3]=e.children,r[4]=o,r[5]=i):i=r[5],i}let ni=j("component:PortableTextEditor");class nr extends h.Component{static displayName="PortableTextEditor";change$=new m.x;constructor(e){super(e),e.editor?this.editor=e.editor:this.editor=function(e){let t=(0,_.A)(t3,{input:t6(e)});return t.start(),t5(t)}({keyGenerator:e.keyGenerator??t8,schema:e.schemaType,initialValue:e.value,maxBlocks:void 0===e.maxBlocks?void 0:Number.parseInt(e.maxBlocks.toString(),10),readOnly:e.readOnly}),this.schemaTypes=this.editor._internal.editorActor.getSnapshot().context.schema,this.editable=this.editor._internal.editable}componentDidUpdate(e){this.props.editor||e.editor||this.props.schemaType===e.schemaType||(this.schemaTypes=P(this.props.schemaType.hasOwnProperty("jsonType")?this.props.schemaType:ed(this.props.schemaType)),this.editor._internal.editorActor.send({type:"update schema",schema:this.schemaTypes})),this.props.editor||e.editor||(this.props.readOnly!==e.readOnly&&this.editor._internal.editorActor.send({type:"update readOnly",readOnly:this.props.readOnly??!1}),this.props.maxBlocks!==e.maxBlocks&&this.editor._internal.editorActor.send({type:"update maxBlocks",maxBlocks:void 0===this.props.maxBlocks?void 0:Number.parseInt(this.props.maxBlocks.toString(),10)}),this.props.value!==e.value&&this.editor._internal.editorActor.send({type:"update value",value:this.props.value}),this.props.editorRef!==e.editorRef&&this.props.editorRef&&(this.props.editorRef.current=this))}setEditable=e=>{this.editor._internal.editable={...this.editor._internal.editable,...e}};render(){let e=this.props.editor?void 0:this.props.incomingPatches$??this.props.patches$;return(0,l.jsxs)(l.Fragment,{children:[e?(0,l.jsx)(no,{editorActor:this.editor._internal.editorActor,patches$:e}):null,(0,l.jsx)(na,{editorActor:this.editor._internal.editorActor,onChange:e=>{this.props.editor||this.props.onChange(e),this.change$.next(e)}}),(0,l.jsx)(ty,{editorActor:this.editor._internal.editorActor,slateEditor:this.editor._internal.slateEditor.instance}),(0,l.jsx)(t9.Provider,{value:this.editor._internal.editorActor,children:(0,l.jsx)(u.mH,{editor:this.editor._internal.slateEditor.instance,initialValue:this.editor._internal.slateEditor.initialValue,children:(0,l.jsx)(el.Provider,{value:this,children:(0,l.jsx)(nn,{editorActor:this.editor._internal.editorActor,children:this.props.children})})})})]})}static activeAnnotations=e=>e&&e.editable?e.editable.activeAnnotations():[];static isAnnotationActive=(e,t)=>!!e&&!!e.editable&&e.editable.isAnnotationActive(t);static addAnnotation=(e,t,n)=>e.editable?.addAnnotation(t,n);static blur=e=>{ni("Host blurred"),e.editable?.blur()};static delete=(e,t,n)=>e.editable?.delete(t,n);static findDOMNode=(e,t)=>e.editable?.findDOMNode(t);static findByPath=(e,t)=>e.editable?.findByPath(t)||[];static focus=e=>{ni("Host requesting focus"),e.editable?.focus()};static focusBlock=e=>e.editable?.focusBlock();static focusChild=e=>e.editable?.focusChild();static getSelection=e=>e.editable?e.editable.getSelection():null;static getValue=e=>e.editable?.getValue();static hasBlockStyle=(e,t)=>e.editable?.hasBlockStyle(t);static hasListStyle=(e,t)=>e.editable?.hasListStyle(t);static isCollapsedSelection=e=>e.editable?.isCollapsedSelection();static isExpandedSelection=e=>e.editable?.isExpandedSelection();static isMarkActive=(e,t)=>e.editable?.isMarkActive(t);static insertChild=(e,t,n)=>(ni("Host inserting child"),e.editable?.insertChild(t,n));static insertBlock=(e,t,n)=>e.editable?.insertBlock(t,n);static insertBreak=e=>e.editable?.insertBreak();static isVoid=(e,t)=>e.editable?.isVoid(t);static isObjectPath=(e,t)=>{if(!t||!Array.isArray(t))return!1;let n=t.length>3&&"children"===t[1];return t.length>1&&"children"!==t[1]||n};static marks=e=>e.editable?.marks();static select=(e,t)=>{ni("Host setting selection",t),e.editable?.select(t)};static removeAnnotation=(e,t)=>e.editable?.removeAnnotation(t);static toggleBlockStyle=(e,t)=>(ni("Host is toggling block style"),e.editable?.toggleBlockStyle(t));static toggleList=(e,t)=>e.editable?.toggleList(t);static toggleMark=(e,t)=>{ni("Host toggling mark",t),e.editable?.toggleMark(t)};static getFragment=e=>(ni("Host getting fragment"),e.editable?.getFragment());static undo=e=>{ni("Host undoing"),e.editable?.undo()};static redo=e=>{ni("Host redoing"),e.editable?.redo()};static isSelectionsOverlapping=(e,t,n)=>e.editable?.isSelectionsOverlapping(t,n)}function no(e){let t,n;let i=(0,y.c)(4);return i[0]!==e.editorActor||i[1]!==e.patches$?(t=()=>{let t=e.patches$.subscribe(t=>{e.editorActor.send({type:"patches",...t})});return()=>{t.unsubscribe()}},n=[e.editorActor,e.patches$],i[0]=e.editorActor,i[1]=e.patches$,i[2]=t,i[3]=n):(t=i[2],n=i[3]),(0,h.useEffect)(t,n),null}function na(e){let t,n,i;let r=(0,y.c)(6);r[0]!==e?(t=t=>e.onChange(t),r[0]=e,r[1]=t):t=r[1];let o=(0,k.i)(t);return r[2]!==o||r[3]!==e.editorActor?(n=()=>{ni("Subscribing to editor changes");let t=e.editorActor.on("*",e=>{switch(e.type){case"blurred":o({type:"blur",event:e.event});break;case"patch":case"mutation":case"ready":case"selection":case"unset":o(e);break;case"loading":o({type:"loading",isLoading:!0});break;case"done loading":o({type:"loading",isLoading:!1});break;case"focused":o({type:"focus",event:e.event});break;case"value changed":o({type:"value",value:e.value});break;case"invalid value":o({type:"invalidValue",resolution:e.resolution,value:e.value});break;case"error":o({...e,level:"warning"})}});return()=>{ni("Unsubscribing to changes"),t.unsubscribe()}},i=[e.editorActor,o],r[2]=o,r[3]=e.editorActor,r[4]=n,r[5]=i):(n=r[4],i=r[5]),(0,h.useEffect)(n,i),null}let nl=j("components:Leaf"),ns=[],nc=e=>{let{editorActor:t,attributes:n,children:i,leaf:r,schemaTypes:o,renderChild:a,renderDecorator:s,renderAnnotation:d}=e,f=(0,h.useRef)(null),y=es(),m=(0,u.vt)(),[k,v]=(0,h.useState)(!1),[b,x]=(0,h.useState)(!1),_=i.props.parent,w=(0,h.useMemo)(()=>_?[{_key:_?._key},"children",{_key:r._key}]:[],[_,r._key]),E=(0,h.useMemo)(()=>o.decorators.map(e=>e.value),[o.decorators]),S=(0,h.useMemo)(()=>g((r.marks||ns).filter(e=>E.includes(e))),[E,r.marks]),N=Array.isArray(r.marks)?r.marks:ns,T=(0,h.useMemo)(()=>N.map(e=>!E.includes(e)&&_?.markDefs?.find(t=>t._key===e)).filter(Boolean),[N,_,E]),A=T.length>0&&m;(0,h.useEffect)(()=>{if(!A){v(!1);return}let e=nr.getSelection(y);e&&c(e.focus.path,w)&&nr.isCollapsedSelection(y)&&(0,h.startTransition)(()=>{v(!0)})},[A,w,y]);let R=(0,h.useCallback)(()=>{if(!A)return;nl("Setting selection and focus from range");let e=window.getSelection();if(!e){x(!1);return}if(e&&e.rangeCount>0){let t=e.getRangeAt(0);f.current&&t.intersectsNode(f.current)?x(!0):x(!1)}else x(!1)},[A]);(0,h.useEffect)(()=>{if(!A)return;let e=t.on("blur",()=>{v(!1),x(!1)}),n=t.on("focus",()=>{let e=nr.getSelection(y);e&&c(e.focus.path,w)&&nr.isCollapsedSelection(y)&&v(!0),R()}),i=t.on("selection",e=>{e.selection&&c(e.selection.focus.path,w)&&nr.isCollapsedSelection(y)?v(!0):v(!1),R()});return()=>{e.unsubscribe(),n.unsubscribe(),i.unsubscribe()}},[t,w,y,R,A]),(0,h.useEffect)(()=>R(),[R]);let M=(0,h.useMemo)(()=>{let e=i;if(p.xv.isText(r)&&r._type===o.span.name&&(S.forEach(t=>{let n=o.decorators.find(e=>e.value===t);n&&s&&(e=s(Object.defineProperty({children:e,editorElementRef:f,focused:k,path:w,selected:b,schemaType:n,value:t},"type",{enumerable:!1,get:()=>(console.warn("Property 'type' is deprecated, use 'schemaType' instead."),n)})))}),_&&T.length>0&&T.forEach(t=>{let n=o.annotations.find(e=>e.name===t._type);if(n){if(d){let i=Object.defineProperty({block:_,children:e,editorElementRef:f,focused:k,path:w,selected:b,schemaType:n,value:t},"type",{enumerable:!1,get:()=>(console.warn("Property 'type' is deprecated, use 'schemaType' instead."),n)});e=(0,l.jsx)("span",{ref:f,children:d(i)})}else e=(0,l.jsx)(ec,{annotation:t,children:(0,l.jsx)("span",{ref:f,children:e})})}}),_&&a)){let t=_.children.find(e=>e._key===r._key);t&&(e=a(Object.defineProperty({annotations:T,children:(0,l.jsx)(l.Fragment,{children:e}),editorElementRef:f,focused:k,path:w,schemaType:o.span,selected:b,value:t},"type",{enumerable:!1,get:()=>(console.warn("Property 'type' is deprecated, use 'schemaType' instead."),o.span)})))}return e},[T,_,i,k,r,S,w,d,a,s,o.annotations,o.decorators,o.span,b]);return(0,h.useMemo)(()=>(0,l.jsx)("span",{...n,ref:f,children:M},r._key),[r,n,M])};nc.displayName="Leaf";let nd=j("plugin:withHotKeys"),nh=j("plugin:withInsertData"),np={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function nu(e,t,n){e.withoutNormalizing(()=>{if(!e.selection)return;let[i,r]=p.ML.node(e,e.selection,{depth:1});if(e.isTextBlock(i)&&e.isTextBlock(t[0])){let{markDefs:n}=i;nh("Mixing markDefs of focusBlock and fragments[0] block",n,t[0].markDefs),c(n,t[0].markDefs)||p.YR.setNodes(e,{markDefs:g([...t[0].markDefs||[],...n||[]])},{at:r,mode:"lowest",voids:!1})}W(e.children,n)?(p.YR.splitNodes(e,{at:[0,0]}),e.insertFragment(t),p.YR.removeNodes(e,{at:[0]})):e.insertFragment(t)}),e.onChange()}let nf=j("component:Editable"),ny={position:"absolute",userSelect:"none",pointerEvents:"none",left:0,right:0},ng=(0,h.forwardRef)(function(e,t){let{hotkeys:n,onBlur:i,onFocus:r,onBeforeInput:o,onPaste:a,onCopy:f,onClick:y,rangeDecorations:g,renderAnnotation:m,renderBlock:k,renderChild:v,renderDecorator:b,renderListItem:x,renderPlaceholder:_,renderStyle:w,selection:E,scrollSelectionIntoView:S,spellCheck:N,...T}=e,A=es(),R=(0,h.useRef)(null),[M,C]=(0,h.useState)(null),[P,O]=(0,h.useState)(!1),[j,L]=(0,h.useState)([]);(0,h.useImperativeHandle)(t,()=>R.current);let $=(0,h.useRef)(g),G=(0,h.useContext)(t9),V=(0,s.v9)(G,e=>e.matches({"edit mode":"read only"})),K=(0,s.v9)(G,e=>e.context.schema),H=(0,u.ui)(),q=K.block.name;(0,h.useMemo)(()=>{let e=function(e){let t=K.block.name,n=K.span.name,i=K.block.options.unstable_whitespaceOnPasteMode,r=t=>t.map(t=>e.isTextBlock(t)?t.children.map(e=>e._type===n?e.text:`[${K.inlineObjects.find(t=>t.name===e._type)?.title||"Object"}]`).join(""):`[${K.blockObjects.find(e=>e.name===t._type)?.title||"Object"}]`).join(`

`);return e.setFragmentData=(n,i)=>{let{selection:o}=e;if(!o)return;let[a,l]=p.e6.edges(o),s=p.ML.void(e,{at:a.path}),c=p.ML.void(e,{at:l.path});if(p.e6.isCollapsed(o)&&!s)return;let d=u.F3.toDOMRange(e,o),h=d.cloneContents();if(c){let[t]=c,n=d.cloneRange(),i=u.F3.toDOMNode(e,t);n.setEndAfter(i),h=n.cloneContents()}Array.from(h.querySelectorAll("[data-slate-zero-width]")).forEach(e=>{let t="n"===e.getAttribute("data-slate-zero-width");e.textContent=t?`
`:""}),Array.from(h.querySelectorAll("*")).forEach(e=>{for(let t in e.removeAttribute("contentEditable"),e.removeAttribute("data-slate-inline"),e.removeAttribute("data-slate-leaf"),e.removeAttribute("data-slate-node"),e.removeAttribute("data-slate-spacer"),e.removeAttribute("data-slate-string"),e.removeAttribute("data-slate-zero-width"),e.removeAttribute("draggable"),e.attributes)e.hasAttribute(t)&&e.removeAttribute(t)});let f=h.ownerDocument.createElement("div");f.appendChild(h),f.setAttribute("hidden","true"),h.ownerDocument.body.appendChild(f);let y=f.innerHTML;h.ownerDocument.body.removeChild(f);let g=F(e.getFragment(),t),m=JSON.stringify(g),k=r(g);n.clearData(),n.setData("text/plain",k),n.setData("text/html",y),n.setData("application/json",m),n.setData("application/x-portable-text",m),nh("text",k),n.setData("application/x-portable-text-event-origin",i||"external"),nh("Set fragment data",m,y)},e.insertPortableTextData=t=>{if(!e.selection)return!1;let i=t.getData("application/x-portable-text"),r=t.getData("application/x-portable-text-event-origin");if(nh(`Inserting portable text from ${r} event`,i),i){let t=JSON.parse(i);if(Array.isArray(t)&&t.length>0){var o,a;let i=(o=U(t,{schemaTypes:K}),a=G.getSnapshot().context.keyGenerator,o.map(t=>{let i={...t};if(e.isTextBlock(i)){let t=K.annotations.map(e=>e.name);if(0===t.length){let{markDefs:e,...t}=i;return{...t,_key:a()}}if((i.markDefs||[]).some(e=>!t.includes(e._type))){let e=(i.markDefs||[]).filter(e=>t.includes(e._type));return{...i,markDefs:e,_key:a()}}i.markDefs=(i.markDefs||[]).map(t=>{let r=t._key,o=a();return i.children=i.children.map(t=>t._type===n&&e.isTextSpan(t)?{...t,marks:t.marks&&t.marks.includes(r)?[...t.marks].filter(e=>e!==r).concat(o):t.marks}:t),{...t,_key:o}})}let r={...i,_key:a()};return e.isTextBlock(r)&&(r.children=r.children.map(e=>({...e,_key:a()}))),r})),r=ep(t,K,G.getSnapshot().context.keyGenerator);if(!r.valid&&!r.resolution?.autoResolve){let e=`${r.resolution?.description}`;return G.send({type:"error",name:"pasteError",description:e,data:r}),nh("Invalid insert result",r),!1}return nu(e,i,K),!0}}return!1},e.insertTextOrHTMLData=t=>{if(!e.selection)return nh("No selection, not inserting"),!1;let n=t.getData("text/html"),r=t.getData("text/plain");if(n||r){let o,a,l;if(nh("Inserting data",t),n){if(a=U(o=(0,D.zW)(n,K.portableText,{unstable_whitespaceOnPasteMode:i,keyGenerator:G.getSnapshot().context.keyGenerator}),{schemaTypes:K}),l="HTML",0===o.length)return!1}else{let e=`<html><body>${String(r).replace(/[&<>"'`=/]/g,e=>np[e]).split(/\n{2,}/).map(e=>e?`<p>${e.replace(/(?:\r\n|\r|\n)/g,"<br/>")}</p>`:"<p></p>").join("")}</body></html>`;a=U(o=(0,D.zW)(e,K.portableText,{keyGenerator:G.getSnapshot().context.keyGenerator}),{schemaTypes:K}),l="text"}let s=ep(o,K,G.getSnapshot().context.keyGenerator);if(!s.valid){let e=`Could not validate the resulting portable text to insert.
${s.resolution?.description}
Try to insert as plain text (shift-paste) instead.`;return G.send({type:"error",name:"pasteError",description:e,data:s}),nh("Invalid insert result",s),!1}return nh(`Inserting ${l} fragment at ${JSON.stringify(e.selection)}`),nu(e,a,K),!0}return!1},e.insertData=t=>{e.insertPortableTextData(t)||e.insertTextOrHTMLData(t)},e.insertFragmentData=t=>{let n=t.getData("application/x-portable-text");if(n){let t=JSON.parse(n);return e.insertFragment(t),!0}return!1},e};if(V)return nf("Editable is in read only mode"),e(H);let t=function(e,t,n){let i=["enter","tab","shift","delete","end"],r=n??{};return function(n){return n.pteWithHotKeys=o=>{Object.keys(r).forEach(a=>{if("marks"===a)for(let t in r[a]){if(i.includes(t))throw Error(`The hotkey ${t} is reserved!`);if((0,B.P6)(t,o.nativeEvent)){o.preventDefault();let i=r[a];if(i){let r=i[t];nd(`HotKey ${t} to toggle ${r}`),e.send({type:"behavior event",behaviorEvent:{type:"decorator.toggle",decorator:r},editor:n})}}}if("custom"===a)for(let e in r[a]){if(i.includes(e))throw Error(`The hotkey ${e} is reserved!`);if((0,B.P6)(e,o.nativeEvent)){let n=r[a];n&&(0,n[e])(o,t)}}})},n}}(G,A,n);return nf("Editable is in edit mode"),e(t(H))},[G,n,A,V,K,H]);let J=(0,h.useCallback)(e=>(0,l.jsx)(ea,{...e,readOnly:V,renderBlock:k,renderChild:v,renderListItem:x,renderStyle:w,schemaTypes:K,spellCheck:N}),[K,N,V,k,v,x,w]),Z=(0,h.useCallback)(e=>{if("span"===e.leaf._type){let t=(0,l.jsx)(nc,{...e,editorActor:G,schemaTypes:K,renderAnnotation:m,renderChild:v,renderDecorator:b,readOnly:V});if(_&&e.leaf.placeholder&&""===e.text.text)return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{style:ny,contentEditable:!1,children:_()}),t]});let n=e.leaf.rangeDecoration;return n&&(t=n.component({children:t})),t}return e.children},[G,V,m,v,b,_,K]),X=(0,h.useCallback)(()=>{if(E){nf(`Selection from props ${JSON.stringify(E)}`);let e=function(e,t){if(!e||!t||0===t.length)return null;let n=null,i=null,{anchor:r,focus:o}=e;return r&&t.find(e=>c({_key:e._key},r.path[0]))&&(n=I(r,t)),o&&t.find(e=>c({_key:e._key},o.path[0]))&&(i=I(o,t)),n&&i?{anchor:n,focus:i,backward:e.backward}:null}(E,F(H.children,q));if(null!==e){nf(`Normalized selection from props ${JSON.stringify(e)}`);let t=z(e,H);t&&(p.YR.select(H,t),H.operations.some(e=>"set_selection"===e.type)||G.send({type:"selection",selection:e}),H.onChange())}}},[q,G,E,H]),Q=(0,h.useCallback)(e=>{if(g&&g.length>0){let t=[];if(g.forEach(n=>{let i;let r=z(n.selection,H);if(!p.e6.isRange(r)){n.onMoved&&n.onMoved({newSelection:null,rangeDecoration:n,origin:"local"});return}if(e&&((i=function(e,t){let n=p.E9.transform(e.anchor,t),i=p.E9.transform(e.focus,t);return null===n||null===i?null:p.E9.equals(n,e.anchor)&&p.E9.equals(i,e.focus)?e:{anchor:n,focus:i}}(r,e))&&i!==r||null===i&&r)){let e=Y(nr.getValue(A),i,K);n.onMoved&&n.onMoved({newSelection:e,rangeDecoration:n,origin:"local"})}null!==i&&t.push({...i||r,rangeDecoration:n})}),t.length>0){L(t);return}}L(e=>e.length>0?[]:e)},[A,g,K,H]);(0,h.useEffect)(()=>{let e=G.on("ready",()=>{Q(),X()}),t=G.on("invalid value",()=>{O(!0)}),n=G.on("value changed",()=>{O(!1)});return()=>{e.unsubscribe(),t.unsubscribe(),n.unsubscribe()}},[G,X,Q]),(0,h.useEffect)(()=>{E&&!P&&X()},[P,E,X]);let[ee,et]=(0,h.useState)(!1);(0,h.useEffect)(()=>{ee||(et(!0),Q())},[Q,ee]),(0,h.useEffect)(()=>{c(g,$.current)||Q(),$.current=g},[g,Q]),(0,h.useEffect)(()=>{let e=function({editorActor:e,slateEditor:t,syncRangeDecorations:n}){let i=t.apply;return t.apply=t=>{i(t),e.getSnapshot().matches({"edit mode":"read only"})||"set_selection"===t.type||n(t)},()=>{t.apply=i}}({editorActor:G,slateEditor:H,syncRangeDecorations:Q});return()=>e()},[G,H,Q]);let en=(0,h.useCallback)(e=>{f?void 0!==f(e)&&e.preventDefault():e.nativeEvent.clipboardData&&G.send({type:"behavior event",behaviorEvent:{type:"copy",data:e.nativeEvent.clipboardData},editor:H,nativeEvent:e})},[f,G,H]),ei=(0,h.useCallback)(e=>{let t=nr.getValue(A),n=Y(t,H.selection,K)?.focus.path||[],i=a?.({event:e,value:t,path:n,schemaTypes:K});i||!H.selection?(e.preventDefault(),G.send({type:"loading"}),Promise.resolve(i).then(t=>{nf("Custom paste function from client resolved",t),t&&t.insert?t.insert?H.insertFragment(U(t.insert,{schemaTypes:K})):console.warn("Your onPaste function returned something unexpected:",t):(nf("No result from custom paste handler, pasting normally"),H.insertData(e.clipboardData))}).catch(e=>(console.error(e),e)).finally(()=>{G.send({type:"done loading"})})):e.nativeEvent.clipboardData&&G.send({type:"behavior event",behaviorEvent:{type:"paste",data:e.nativeEvent.clipboardData},editor:H,nativeEvent:e}),nf("No result from custom paste handler, pasting normally")},[G,a,A,K,H]),er=(0,h.useCallback)(e=>{if(r&&r(e),!e.isDefaultPrevented()){let t=nr.getSelection(A);null===t&&(p.YR.select(H,p.ML.start(H,[])),H.onChange()),G.send({type:"focused",event:e}),t===nr.getSelection(A)&&G.send({type:"selection",selection:t})}},[G,r,A,H]),eo=(0,h.useCallback)(e=>{y&&y(e);let t=H.selection?H.selection.focus.path.slice(0,1):void 0,n=t?p.NB.descendant(H,t):void 0,[i,r]=p.NB.last(H,[]),o=r.slice(0,1),a=!!t&&p.y$.equals(o,t),l=!!n&&!H.isTextBlock(n);H.selection&&p.e6.isCollapsed(H.selection)&&a&&l&&(p.YR.insertNodes(H,H.pteCreateTextBlock({decorators:[]})),H.onChange())},[y,H]),el=(0,h.useCallback)(e=>{i&&i(e),e.isPropagationStopped()||G.send({type:"blurred",event:e})},[G,i]),ec=(0,h.useCallback)(e=>{o&&o(e)},[o]),ed=(0,h.useCallback)(()=>{if(!H.selection)return;let{activeElement:e}=u.F3.findDocumentOrShadowRoot(H);if(R.current!==e)return;let t=u.F3.getWindow(H).getSelection();if(!t||0===t.rangeCount)return;let n=t.getRangeAt(0);try{let e=u.F3.toDOMRange(H,H.selection);(e.startOffset!==n.startOffset||e.endOffset!==n.endOffset)&&(nf("DOM range out of sync, validating selection"),t?.removeAllRanges(),t.addRange(e))}catch{nf("Could not resolve selection, selecting top document"),p.YR.deselect(H),H.children.length>0&&p.YR.select(H,[0,0]),H.onChange()}},[R,H]);(0,h.useEffect)(()=>{if(M){let e=new MutationObserver(ed);return e.observe(M,{attributeOldValue:!1,attributes:!1,characterData:!1,childList:!0,subtree:!0}),()=>{e.disconnect()}}},[ed,M]);let eh=(0,h.useCallback)(t=>{e.onKeyDown&&e.onKeyDown(t),t.isDefaultPrevented()||H.pteWithHotKeys(t),t.isDefaultPrevented()||G.send({type:"behavior event",behaviorEvent:{type:"key.down",keyboardEvent:{key:t.key,code:t.code,altKey:t.altKey,ctrlKey:t.ctrlKey,metaKey:t.metaKey,shiftKey:t.shiftKey}},editor:H,nativeEvent:t})},[e,G,H]),eu=(0,h.useCallback)(t=>{e.onKeyUp&&e.onKeyUp(t),t.isDefaultPrevented()||G.send({type:"behavior event",behaviorEvent:{type:"key.up",keyboardEvent:{key:t.key,code:t.code,altKey:t.altKey,ctrlKey:t.ctrlKey,metaKey:t.metaKey,shiftKey:t.shiftKey}},editor:H,nativeEvent:t})},[e,G,H]),ef=(0,h.useMemo)(()=>{if(void 0!==S)return null===S?d:(e,t)=>{S(A,t)}},[A,S]),ey=(0,h.useCallback)(([,e])=>{if(W(H.children,K))return[{anchor:{path:[0,0],offset:0},focus:{path:[0,0],offset:0},placeholder:!0}];if(0===e.length)return[];let t=j.filter(t=>p.e6.isCollapsed(t)?2===e.length&&p.y$.equals(t.focus.path,e)&&p.y$.equals(t.anchor.path,e):p.e6.intersection(t,{anchor:{path:e,offset:0},focus:{path:e,offset:0}})||p.e6.includes(t,e));return t.length>0?t:[]},[H,K,j]);return(0,h.useEffect)(()=>{R.current=u.F3.toDOMNode(H,H),C(R.current)},[H,R]),A?P?null:(0,l.jsx)(u.CX,{...T,autoFocus:!1,className:T.className||"pt-editable",decorate:ey,onBlur:el,onCopy:en,onClick:eo,onDOMBeforeInput:ec,onFocus:er,onKeyDown:eh,onKeyUp:eu,onPaste:ei,readOnly:V,renderPlaceholder:void 0,renderElement:J,renderLeaf:Z,scrollSelectionIntoView:ef}):null});ng.displayName="ForwardRef(PortableTextEditable)";let nm=h.createContext(void 0);function nk(e){let t,n,i,r,o,a,c,d,h,p;let f=(0,y.c)(28),g=function(e){let t,n,i;let r=(0,y.c)(6);r[0]!==e?(t=t6(e),r[0]=e,r[1]=t):t=r[1],r[2]!==t?(n={input:t},r[2]=t,r[3]=n):n=r[3];let o=(0,s.TH)(t3,n);return r[4]!==o?(i=t5(o),r[4]=o,r[5]=i):i=r[5],i}(e.initialConfig),m=g._internal.editorActor,k=g._internal.slateEditor;return f[0]!==g?(n=new nr({editor:g}),f[0]=g,f[1]=n):n=f[1],t=n,f[2]!==t.change$?(i=e=>{t.change$.next(e)},f[2]=t.change$,f[3]=i):i=f[3],f[4]!==m||f[5]!==i?(r=(0,l.jsx)(na,{editorActor:m,onChange:i}),f[4]=m,f[5]=i,f[6]=r):r=f[6],f[7]!==m||f[8]!==k.instance?(o=(0,l.jsx)(ty,{editorActor:m,slateEditor:k.instance}),f[7]=m,f[8]=k.instance,f[9]=o):o=f[9],f[10]!==m||f[11]!==e.children?(a=(0,l.jsx)(nn,{editorActor:m,children:e.children}),f[10]=m,f[11]=e.children,f[12]=a):a=f[12],f[13]!==t||f[14]!==a?(c=(0,l.jsx)(el.Provider,{value:t,children:a}),f[13]=t,f[14]=a,f[15]=c):c=f[15],f[16]!==k.initialValue||f[17]!==k.instance||f[18]!==c?(d=(0,l.jsx)(u.mH,{editor:k.instance,initialValue:k.initialValue,children:c}),f[16]=k.initialValue,f[17]=k.instance,f[18]=c,f[19]=d):d=f[19],f[20]!==m||f[21]!==d?(h=(0,l.jsx)(t9.Provider,{value:m,children:d}),f[20]=m,f[21]=d,f[22]=h):h=f[22],f[23]!==g||f[24]!==r||f[25]!==o||f[26]!==h?(p=(0,l.jsxs)(nm.Provider,{value:g,children:[r,o,h]}),f[23]=g,f[24]=r,f[25]=o,f[26]=h,f[27]=p):p=f[27],p}function nv(){let e=h.useContext(nm);if(!e)throw Error("No Editor set. Use EditorProvider to set one.");return e}function nb(e){let t,n;let i=(0,y.c)(4),r=nv(),o=(0,k.i)(e.on);return i[0]!==r||i[1]!==o?(t=()=>{let e=r.on("*",o);return()=>{e.unsubscribe()}},n=[r,o],i[0]=r,i[1]=o,i[2]=t,i[3]=n):(t=i[2],n=i[3]),(0,h.useEffect)(t,n),null}}}]);